!function a(r,s,l){function c(t,e){if(!s[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=s[t]={exports:{}};r[t][0].call(i.exports,function(e){return c(r[t][1][e]||e)},i,i.exports,a,r,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=(o(r,[{key:"handle_message",value:function(){this.session.close_session()}}]),r);function r(e){v(this,r),this.session=e,this.accept_command=["close_session"]}n.CloseHandler=a;var s=(o(_,[{key:"dispatch_message",value:function(e){return e.command in this.command2handler&&(this.command2handler[e.command].handle_message(e),!0)}}]),_);function _(){v(this,_),this.command2handler={};for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=!0,i=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var l=r.value,c=!0,u=!1,d=void 0;try{for(var p,f=l.accept_command[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var h=p.value;if(h in this.command2handler)throw new Error("Conflict command handler: both "+this.command2handler[h]+" and "+l+" accepts '"+h+"' command");this.command2handler[h]=l}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}}n.CommandDispatcher=s},{}],2:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../utils"),r=(o(s,[{key:"handle_message",value:function(e){var t=a.b64toBlob(e.spec.content);saveAs(t,e.spec.name,{},!1)}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.accept_command=["download"]}n.DownloadHandler=r},{"../utils":22}],3:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../session"),r=e("../state"),s=(o(l,[{key:"handle_message",value:function(e){var t=e.spec;void 0!==t.title&&(document.title=t.title),void 0!==t.auto_scroll_bottom&&(r.state.AutoScrollBottom=t.auto_scroll_bottom),void 0!==t.output_animation&&(r.config.outputAnimation=t.output_animation),void 0!==t.http_pull_interval&&r.state.CurrentSession instanceof a.HttpSession&&r.state.CurrentSession.change_pull_interval(t.http_pull_interval)}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.accept_command=["set_env"]}n.EnvSettingHandler=s},{"../session":19,"../state":20}],4:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../utils"),s=e("../state"),r=e("../models/input"),l=e("../ui"),c=(o(u,[{key:"_after_show_form",value:function(){setTimeout(function(){var e=$("#input-cards > .card")[0];e.style.height="unset",e.style.width="unset"},50),l.show_input();var e=this.form_ctrls.get_top();e&&e[e.length-1].after_show(),$('[auto_focus="true"]').focus()}},{key:"_activate_form",value:function(e,t){var n=this,o=this.form_ctrls.get_value(e),i=o[o.length-1];if(i===t||void 0===t)return i.element.show(s.state.ShowDuration,function(){n._after_show_form()});this.form_ctrls.move_to_top(e),t.element.hide(100,function(){var e=n.form_ctrls.get_top();e&&e[e.length-1].element.show(s.state.ShowDuration,function(){n._after_show_form()})})}},{key:"handle_message",value:function(e){var t=this,n=this.form_ctrls.get_top(),o=n&&n[n.length-1],i=this.form_ctrls.get_value(e.task_id);if(void 0===i&&(this.form_ctrls.push(e.task_id,[]),i=this.form_ctrls.get_value(e.task_id)),e.command in p.make_set(["input","input_group"])){var a=new d(this.session,e.task_id,e.spec);i.push(a),this.container_elem.append(a.create_element()),a.after_add_to_dom(),this._activate_form(e.task_id,o)}else if(e.command in p.make_set(["update_input"])){if(0===i.length)return console.error("No form to current message. task_id:%s",e.task_id);i[i.length-1].dispatch_ctrl_message(e.spec)}else if("destroy_form"===e.command){if(0===i.length)return console.error("No form to current message. task_id:%s",e.task_id);var r=i.pop();0===i.length&&this.form_ctrls.remove(e.task_id),n===i?r.element.hide(100,function(){r.element.remove(),l.close_input();var e=t.form_ctrls.get_top();e&&e[e.length-1].element.show(s.state.ShowDuration,function(){t._after_show_form()})}):(r.element.remove(),l.close_input())}}}]),u);function u(e,t){a(this,u),this.accept_command=["input","input_group","update_input","destroy_form"],this.session=e,this.container_elem=t,this.form_ctrls=new p.LRUMap}n.InputHandler=c;var d=(o(f,[{key:"create_element",value:function(){var c=this,e=Mustache.render('\n            <div class="card" style="display: none">\n                <h5 class="card-header">{{label}}</h5>\n                <div class="card-body">\n                    <form>\n                        <div class="input-container"></div>\n                        <div class="ws-form-submit-btns">\n                            <button type="submit" class="btn btn-primary">提交</button>\n                            <button type="reset" class="btn btn-warning">重置</button>\n                            {{#cancelable}}<button type="button" class="pywebio_cancel_btn btn btn-danger">取消</button>{{/cancelable}}\n                        </div>\n                    </form>\n                </div>\n            </div>',{label:this.spec.label,cancelable:this.spec.cancelable}),u=$(e);if(u.find(".pywebio_cancel_btn").on("click",function(e){u.find("button").prop("disabled",!0),c.session.send_message({event:"from_cancel",task_id:c.task_id,data:null})}),this.spec.inputs.length&&"actions"===this.spec.inputs[this.spec.inputs.length-1].type){var t=!0,n=!1,o=void 0;try{for(var i,a=this.spec.inputs[this.spec.inputs.length-1].buttons[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)if("submit"===i.value.type){u.find(".ws-form-submit-btns").hide();break}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}}var r=u.find(".input-container");for(var s in this.spec.inputs){var l=this.spec.inputs[s];if(!(l.type in f.input_items))throw new Error("Unknown input type '"+l.type+"'");var d=new f.input_items[l.type](this.session,this.task_id,l);this.name2input[l.name]=d,r.append(d.create_element())}return u.on("submit","form",function(e){for(var t in e.preventDefault(),c.name2input)if(!c.name2input[t].check_valid())return p.error_alert("输入项存在错误，请消除错误后再提交");var n={};$.each(c.name2input,function(e,t){n[e]=t.get_value()});var o=void 0,i=!0,a=!1,r=void 0;try{for(var s,l=c.spec.inputs[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)if("file"==s.value.type){o=c.make_progress();break}}catch(e){a=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw r}}u.find("button").prop("disabled",!0),c.session.send_message({event:"from_submit",task_id:c.task_id,data:n},o)}),this.element=u}},{key:"make_progress",value:function(){var e=$('<div class="progress" style="margin-top: 4px;">\n                        <div class="progress-bar bg-info progress-bar-striped progress-bar-animated" role="progressbar"\n                             style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%\n                        </div>\n                    </div>');this.element.find(".card-body").append(e);var o=e.find(".progress-bar");return function(e,t){var n=""+(100*e/t).toFixed(1);o[0].style.width=n+"%",o.attr("aria-valuenow",n),o.text(n+"%")}}},{key:"dispatch_ctrl_message",value:function(e){if(this.element.find("button:not([data-pywebio-disabled])").prop("disabled",!1),this.element.find(".progress").remove(),!(e.target_name in this.name2input))return console.error("Can't find input[name=%s] element in curr form!",e.target_name);this.name2input[e.target_name].update_input(e)}},{key:"after_add_to_dom",value:function(){for(var e in this.name2input)this.name2input[e].after_add_to_dom()}},{key:"after_show",value:function(){for(var e in this.name2input)this.name2input[e].after_show(0===this.show_count);this.show_count+=1}}],[{key:"register_inputitem",value:function(e){var t=!0,n=!1,o=void 0;try{for(var i,a=e.accept_input_types[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var r=i.value;if(r in this.input_items)throw new Error("duplicated accept_input_types:["+r+"] in "+e+" and "+this.input_items[r]);this.input_items[r]=e}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}}}]),f);function f(e,t,n){a(this,f),this.element=null,this.name2input={},this.show_count=0,this.session=e,this.task_id=t,this.spec=n}var h=!0,v=!(d.input_items={}),_=void 0;try{for(var m,b=r.all_input_items[Symbol.iterator]();!(h=(m=b.next()).done);h=!0){var y=m.value;d.register_inputitem(y)}}catch(e){v=!0,_=e}finally{try{!h&&b.return&&b.return()}finally{if(v)throw _}}},{"../models/input":14,"../state":20,"../ui":21,"../utils":22}],5:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../state"),l=e("../utils"),f=e("../models/output"),h=["script","style"],a=(o(r,[{key:"scroll_bottom",value:function(){l.body_scroll_to($(".pywebio"),"bottom",null,15)}},{key:"handle_message",value:function(t){var e=this,n=!1;if("output"===t.command){var o=void 0;try{o=f.getWidgetElement(t.spec)}catch(e){return console.error("Handle command error, command: "+t+", error:"+e)}var i=$(t.spec.scope);if(p.config.outputAnimation&&-1==h.indexOf(o[0].tagName.toLowerCase())&&1==i.length&&o.hide(),0===i.length)return console.error("Scope '"+t.spec.scope+"' not found");if(t.spec.scope&&"#pywebio-scope-ROOT"!==t.spec.scope||(n=!0),0===t.spec.position)i.prepend(o);else if(-1===t.spec.position)i.append(o);else{var a=!0,r=!1,s=void 0;try{for(var l,c=i[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value,d=$(u.children).eq(t.spec.position);0<=t.spec.position?o.insertBefore(d):o.insertAfter(d)}}catch(e){r=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(r)throw s}}}-1==h.indexOf(o[0].tagName.toLowerCase())&&1==i.length&&(p.config.outputAnimation?o.fadeIn({complete:function(){p.state.AutoScrollBottom&&n&&e.scroll_bottom()}}):p.state.AutoScrollBottom&&n&&this.scroll_bottom())}else"output_ctl"===t.command&&this.handle_output_ctl(t)}},{key:"handle_output_ctl",value:function(e){if(void 0!==e.spec.set_scope){var t=e.spec,n=$(""+t.container);if(0===n.length)return console.error("Scope '"+e.spec.scope+"' not found");var o=$("#"+t.set_scope);if(o.length){if("remove"!=t.if_exist)return"clear"==t.if_exist?void o.empty():void 0;o.remove()}var i='<div id="'+t.set_scope+'"></div>';0===t.position?n.prepend(i):-1===t.position?n.append(i):0<=t.position?$(t.container+">*").eq(t.position).insertBefore(i):$(t.container+">*").eq(t.position).insertAfter(i)}var a,r,s;void 0!==e.spec.clear&&$(e.spec.clear).empty(),void 0!==e.spec.clear_before&&$(""+e.spec.clear_before).prevAll().remove(),void 0!==e.spec.clear_after&&$(e.spec.clear_after+"~*").remove(),void 0!==e.spec.scroll_to&&((a=$(""+e.spec.scroll_to)).length?l.body_scroll_to(a,e.spec.position):console.error("Scope "+e.spec.scroll_to+" not found")),void 0!==e.spec.clear_range&&$(""+e.spec.clear_range[0]).length&&$(""+e.spec.clear_range[1]).length&&(s=!(r=[]),$(e.spec.clear_range[0]+"~*").each(function(){if(this.id===e.spec.clear_range[1])return!(s=!0);r.push(this)}),s?$(r).remove():console.warn("clear_range not valid: can't find "+e.spec.clear_range[1]+" after "+e.spec.clear_range[0])),void 0!==e.spec.remove&&$(""+e.spec.remove).remove()}}]),r);function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.accept_command=["output","output_ctl"],this.session=e,this.container_elem=t,this.container_parent=this.container_elem.parent()}n.OutputHandler=a},{"../models/output":18,"../state":20,"../utils":22}],6:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../models/output"),r=(o(s,[{key:"handle_message",value:function(e){var t;s.current_elem&&(s.current_elem.modal("hide"),s.current_elem=null),"popup"==e.command?($(".modal").modal("hide"),t=s.get_element(e.spec),this.body.append(t),t.on("hidden.bs.modal",function(e){t.remove()}),t.on("shown.bs.modal",function(e){t==s.current_elem&&s.current_elem||t.modal("hide")}),t.modal("show"),s.current_elem=t):"close_popup"==e.command&&($(".modal").modal("hide"),s.current_elem=null)}}],[{key:"get_element",value:function(e){e.closable||(e.implicit_close=!1);var t=Mustache.render('<div class="modal fade" {{^implicit_close}}data-backdrop="static"{{/implicit_close}} aria-labelledby="model-id-{{ dom_id }}" tabindex="-1" role="dialog" aria-hidden="true">\n          <div class="modal-dialog modal-dialog-scrollable {{#large}}modal-lg{{/large}} {{#small}}modal-sm{{/small}}" role="document">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title" id="model-id-{{ mid }}">{{ title }}</h5>\n                {{#closable}}\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n                {{/closable}}\n              </div>\n              <div class="modal-body markdown-body" id="{{ dom_id }}">\n                {{#content}}\n                    {{& pywebio_output_parse}}\n                {{/content}}\n              </div>\n              \x3c!--  \n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n                <button type="button" class="btn btn-primary">Submit</button>\n              </div> \n              --\x3e\n            </div>\n          </div>\n        </div>',Object.assign(Object.assign({},e),{large:"large"==e.size,small:"small"==e.size,pywebio_output_parse:function(){return this.type?a.outputSpecToHtml(this):a.outputSpecToHtml({type:"text",content:this,inline:!0})}}));return $(t)}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.accept_command=["popup","close_popup"],this.body=$("body"),this.session=e}(n.PopupHandler=r).current_elem=null},{"../models/output":18}],7:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=(o(r,[{key:"handle_message",value:function(e){var t=e.spec.code,n=e.spec.args,o=["WebIOCurrentTaskID"],i=[e.task_id];for(var a in n)o.push(a),i.push(n[a]);(new(Function.prototype.bind.apply(Function,[null].concat(o,[t])))).apply(void 0,i)}}]),r);function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.accept_command=["run_script"],this.session=e}n.ScriptHandler=a},{}],8:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../state"),r=(o(s,[{key:"handle_message",value:function(e){var t=e.spec,n=Toastify({text:Mustache.escape(t.content),duration:0===t.duration?-1:t.duration,close:0===t.duration,gravity:"top",position:t.position,backgroundColor:t.color,stopOnFocus:!0,onClick:function(){if(t.callback_id){if(null===a.state.CurrentSession)return console.error("Error: WebIOController is not instantiated");a.state.CurrentSession.send_message({event:"callback",task_id:t.callback_id,data:null}),n.hideToast()}}});n.showToast()}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.accept_command=["toast"]}n.ToastHandler=r},{"../state":20}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var p=e("./state"),s=e("./session"),f=e("./handlers/input"),h=e("./handlers/output"),v=e("./handlers/base"),_=e("./handlers/popup"),o=e("./utils"),m=e("./handlers/script"),b=e("./handlers/download"),y=e("./handlers/toast"),g=e("./handlers/env");window.WebIO={startWebIOClient:function(n,o,i,e){for(var t in e)p.config[t]=e[t];var a,r=(a=new URLSearchParams(window.location.search).get("pywebio_api")||"./io",new URL(a,window.location.href).href);s.is_http_backend(r).then(function(e){var t=void 0;(function(e,t,n){(p.state.CurrentSession=e).on_session_close(function(){$("#favicon32").attr("href","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAByElEQVRYR82XLUzDUBDH/9emYoouYHAYMGCAYJAYEhxiW2EOSOYwkKBQKBIwuIUPN2g7gSPBIDF8GWbA4DAjG2qitEfesi6lbGxlXd5q393/fr333t07QpdfPp8f0nV9CcACEU0DGAOgN9yrAN6Y+QnATbVavcrlcp/dSFMnI9M0J1RV3WHmFQCJTvaN9RoRXbiuu28YxstfPm0BbNtOMPMeEW0C0LoMHDZzmPmIiHbT6XStlUZLgEKhMK5p2iWAyX8GDruVHMdZzmazr+GFXwCmac4oinINYCSm4L5M2fO8RcMwHoO6PwAaf37bh+BNCMdx5oOZaAKIPQdwF2Pa2yWwBGDOPxNNAMuyDohoK+a0t5Rj5sNMJrMtFusA4qopivLcw2mPyu14njclrmgdoFgsnjLzWlSVXuyJ6CyVSq2TqHDJZPI9QpHpJW7Qt1apVEbJsqwVIjqPSzWKDjOvCoBjItqI4hiXLTOfkG3b9wBm4xKNqPMgAMoAhiM6xmX+IQC+AKhxKUbUcQcCQPoWyD2E0q+h9EIkvRRLb0YD0Y4FhNQHiQCQ/iQTEFIfpX4Nl/os9yGkDiY+hNTRLNhSpQ2n4b7er/H8G7N6BRSbHvW5AAAAAElFTkSuQmCC"),$("#favicon16").attr("href","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA0ElEQVQ4T62TPQrCQBCF30tA8BZW9mJtY+MNEtKr2HkWK0Xtw+4NbGysxVorbyEKyZMNRiSgmJ/tZufNNzO7M0ThxHHc8zxvSnIIoPNyXyXt0zRdR1F0+gxhblhr25IWJMcA3vcFviRtSc6DILg5XyZ0wQB2AAbFir7YBwAjB8kAxpg1ycmfwZlM0iYMwyldz77vH3+U/Y2rJEn6NMYsSc7KZM+1kla01p4BdKsAAFwc4A6gVRHwaARQr4Xaj1j7G2sPUiOjnEMqL9PnDJRd5ycpJXsd2f2NIAAAAABJRU5ErkJggg==")});var o=new h.OutputHandler(e,t),i=new f.InputHandler(e,n),a=new _.PopupHandler(e),r=new v.CloseHandler(e),s=new m.ScriptHandler(e),l=new b.DownloadHandler,c=new y.ToastHandler,u=new g.EnvSettingHandler,d=new v.CommandDispatcher(o,i,a,r,s,l,c,u);e.on_server_message(function(t){try{d.dispatch_message(t)||console.error("Unknown command:%s",t.command)}catch(e){console.error("Error(%s) in dispatch command: %s",e,t.command)}})})(t=e?new s.HttpSession(r,i,p.config.httpPullInterval):new s.WebSocketSession(r,i),n,o),t.start_session(p.config.debug)})},sendMessage:function(e){return p.state.CurrentSession.send_message(e)},openApp:o.openApp,pushData:s.pushData}},{"./handlers/base":1,"./handlers/download":2,"./handlers/env":3,"./handlers/input":4,"./handlers/output":5,"./handlers/popup":6,"./handlers/script":7,"./handlers/toast":8,"./session":19,"./state":20,"./utils":22}],10:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./base"),r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,a.InputItem),o(s,[{key:"create_element",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,i=this.spec.buttons[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;a.btn_type="submit"===a.type?"submit":"button"}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}var r=Mustache.render('\n<div class="form-group">\n    {{#label}}<label>{{label}}</label>  <br> {{/label}} \n    {{#buttons}}\n    <button type="{{btn_type}}" data-type="{{type}}" aria-describedby="{{name}}_help" {{#disabled}}disabled data-pywebio-disabled{{/disabled}} class="btn btn-primary">{{label}}</button>\n    {{/buttons}}\n    <div class="invalid-feedback">{{invalid_feedback}}</div>  \x3c!-- input 添加 is-invalid 类 --\x3e\n    <div class="valid-feedback">{{valid_feedback}}</div> \x3c!-- input 添加 is-valid 类 --\x3e\n    <small id="{{name}}_help" class="form-text text-muted">{{help_text}}</small>\n</div>',this.spec);this.element=$(r);for(var s=this.element.find("button"),l=0;l<this.spec.buttons.length;l++)s.eq(l).val(JSON.stringify(this.spec.buttons[l].value));var c=this;return this.element.find("button").on("click",function(e){var t=$(this);"submit"===t.data("type")?c.submit_value=JSON.parse(t.val()):"reset"===t.data("type")?t.parents("form").trigger("reset"):"cancel"===t.data("type")?c.session.send_message({event:"from_cancel",task_id:c.task_id,data:null}):console.error("`actions` input: unknown button type '%s'",t.data("type"))}),this.element}},{key:"update_input",value:function(t){var e=t.attributes,n=-1;"target_value"in t&&this.element.find("button").each(function(e){if(JSON.parse($(this).val())===t.target_value)return n=e,!1}),this.update_input_helper(n,e)}},{key:"get_value",value:function(){return this.submit_value}}]),s);function s(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t,n));return o.submit_value=null,o}(n.Actions=r).accept_input_types=["actions"]},{"./base":11}],11:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=(o(r,[{key:"create_element",value:function(){throw new Error("Not implement!")}},{key:"update_input",value:function(){throw new Error("Not implement!")}},{key:"get_value",value:function(){throw new Error("Not implement!")}},{key:"check_valid",value:function(){return!0}},{key:"after_add_to_dom",value:function(){}},{key:"after_show",value:function(){}},{key:"send_value_listener",value:function(e,t){e.session.send_message({event:"input_event",task_id:e.task_id,data:{event_name:t.type.toLowerCase(),name:e.spec.name,value:e.get_value()}})}},{key:"update_input_helper",value:function(e,t){var n={invalid_feedback:"div.invalid-feedback",valid_feedback:"div.valid-feedback",help_text:"small.text-muted"};for(var o in n)o in t&&(-1===e?this.element.find(n[o]).text(t[o]):this.element.find(n[o]).eq(e).text(t[o]),delete t[o]);var i,a=this.element.find("input,select,textarea");0<=e&&(a=a.eq(e)),"valid_status"in t&&(i=t.valid_status?"is-valid":"is-invalid",0===t.valid_status&&(i=""),a.removeClass("is-valid is-invalid").addClass(i),delete t.valid_status),a.prop(t)}}]),r);function r(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.element=null,this.session=e,this.task_id=t,this.spec=n}(n.InputItem=a).accept_input_types=[]},{}],12:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./base"),d=e("../../utils"),s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,r.InputItem),o(l,[{key:"create_element",value:function(){var e=d.deep_copy(this.spec),t=e.name+"-"+Math.floor(Math.random()*Math.floor(9999));for(var n in e.id_name_prefix=t,e.options)e.options[n].idx=n;for(var o=Mustache.render('\n<div class="form-group">\n    {{#label}}<label>{{label}}</label>{{/label}}\n    {{#inline}}<br>{{/inline}}\n    {{#options}}\n    <div class="form-check {{#inline}}form-check-inline{{/inline}}">\n        <input type="{{type}}" id="{{id_name_prefix}}-{{idx}}" name="{{name}}" {{#selected}}checked{{/selected}} {{#disabled}}disabled{{/disabled}} class="form-check-input">\n        <label class="form-check-label" for="{{id_name_prefix}}-{{idx}}">\n            {{label}}\n        </label>\n        <div class="invalid-feedback">{{invalid_feedback}}</div>  \x3c!-- input 添加 is-invalid 类 --\x3e\n        <div class="valid-feedback">{{valid_feedback}}</div> \x3c!-- input 添加 is-valid 类 --\x3e\n    </div>\n    {{/options}}\n    <small id="{{id_name}}_help" class="form-text text-muted">{{help_text}}</small>\n</div>',e),i=$(o),a=(this.element=i).find("input"),r=0;r<e.options.length;r++)a.eq(r).val(JSON.stringify(e.options[r].value));for(var s={value:"",label:"",selected:""},l=0;l<this.spec.options.length;l++){var c=i.find("#"+t+"-"+l);for(var u in this.spec.options[l])u in s||c.attr(u,this.spec.options[l][u])}return this.element}},{key:"update_input",value:function(t){var e=t.attributes,n=-1;"target_value"in t&&this.element.find("input").each(function(e){if(JSON.parse($(this).val())===t.target_value)return n=e,!1}),this.update_input_helper(n,e)}},{key:"get_value",value:function(){if("radio"===this.spec.type){var e=this.element.find("input:checked").val()||"null";return JSON.parse(e)}var t=this.element.find("input").serializeArray(),n=[],o=this;return $.each(t,function(e,t){t.name===o.spec.name&&n.push(JSON.parse(t.value)),console.log(JSON.parse(t.value),i(JSON.parse(t.value)))}),n}}]),l);function l(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e,t,n))}(n.CheckboxRadio=s).accept_input_types=["checkbox","radio"]},{"../../utils":22,"./base":11}],13:[function(e,t,n){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./base"),r=e("../../utils"),s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,a.InputItem),o(l,[{key:"create_element",value:function(){var e=r.deep_copy(this.spec),t=e.name+"-"+Math.floor(Math.random()*Math.floor(9999));e.id_name=t;var n=Mustache.render('\n<div class="form-group">\n    {{#label}}<label for="{{id_name}}">{{label}}</label>{{/label}}\n    <div class="custom-file">\n        <input type="file" name="{{name}}" class="custom-file-input" id="{{id_name}}" aria-describedby="{{id_name}}_help">\n        <label class="custom-file-label" for="{{id_name}}">{{placeholder}}</label>\n        <div class="invalid-feedback">{{invalid_feedback}}</div>  \x3c!-- input 添加 is-invalid 类 --\x3e\n        <div class="valid-feedback">{{valid_feedback}}</div> \x3c!-- input 添加 is-valid 类 --\x3e\n        <small id="{{id_name}}_help"  class="form-text text-muted">{{help_text}}</small>\n    </div>\n</div>',e);this.element=$(n);var c=this.element.find('input[type="file"]'),o={label:"",invalid_feedback:"",valid_feedback:"",help_text:"",placeholder:""};for(var i in this.spec)i in o||c.attr(i,this.spec[i]);var u=this;return c.on("change",function(){u.data_url_value=[];var n=0;u.valid=!0;var e=c[0].files,t=!0,o=!1,i=void 0;try{for(var a,r=function(){var e=a.value,t=new FileReader;if(n+=e.size,u.spec.max_size&&e.size>u.spec.max_size)u.valid=!1,u.update_input_helper(-1,{valid_status:!1,invalid_feedback:'文件"'+e.name+'"大小超过限制: 单个文件大小不超过'+u._formate_size(u.spec.max_size)});else if(u.spec.max_total_size&&n>u.spec.max_total_size)return u.valid=!1,u.update_input_helper(-1,{valid_status:!1,invalid_feedback:"文件总大小超过限制: 文件总大小不超过"+u._formate_size(u.spec.max_total_size)}),{v:void 0};if(!u.valid)return{v:void 0};u.update_input_helper(-1,{valid_status:0}),t.onload=function(){u.data_url_value.push({filename:e.name,size:e.size,mime_type:e.type,last_modified:e.lastModified/1e3,dataurl:t.result})},t.readAsDataURL(e)},s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=r();if("object"===(void 0===l?"undefined":d(l)))return l.v}}catch(e){o=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw i}}}),this.element}},{key:"_formate_size",value:function(e){for(var t=["Byte","Kb","Mb"],n=0;n<t.length;n++){var o=t[n];if(e/1024<1)return e.toFixed(2)+o;e/=1024}return e.toFixed(2)+"Gb"}},{key:"update_input",value:function(e){var t=e.attributes;this.update_input_helper(-1,t)}},{key:"check_valid",value:function(){return this.valid}},{key:"get_value",value:function(){return this.data_url_value}},{key:"after_add_to_dom",value:function(){bsCustomFileInput.init()}}]),l);function l(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e,t,n));return o.data_url_value=[],o.valid=!0,o}(n.File=s).accept_input_types=["file"]},{"../../utils":22,"./base":11}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./input"),i=e("./actions"),a=e("./checkbox_radio"),r=e("./textarea"),s=e("./file"),l=e("./select");n.all_input_items=[o.Input,i.Actions,a.CheckboxRadio,r.Textarea,s.File,l.Select]},{"./actions":10,"./checkbox_radio":12,"./file":13,"./input":15,"./select":16,"./textarea":17}],15:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./base"),s=e("../../utils"),l=e("../../state"),r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,a.InputItem),o(c,[{key:"create_element",value:function(){var t=this,e=s.deep_copy(this.spec),n=e.name+"-"+Math.floor(Math.random()*Math.floor(9999));e.id_name=n,e.datalist&&(e.list=n+"-list");var o=Mustache.render('\n<div class="form-group">\n    {{#label}}<label for="{{id_name}}">{{label}}</label>{{/label}}\n    <div class="input-group">\n        <input type="{{type}}" id="{{id_name}}" aria-describedby="{{id_name}}_action_btn"  {{#list}}list="{{list}}"{{/list}} class="form-control" >\n        <datalist id="{{id_name}}-list">\n            {{#datalist}} \n            <option>{{.}}</option> \n            {{/datalist}}\n        </datalist>\n        {{#action}} \n        <div class="input-group-append">\n            <button class="btn btn-outline-secondary single-input-action-btn" type="button" id="{{id_name}}_action_btn" data-callbackid="{{callback_id}}">{{label}}</button>\n        </div>\n        {{/action}} \n        <div class="invalid-feedback">{{invalid_feedback}}</div>\n        <div class="valid-feedback">{{valid_feedback}}</div>\n    </div>\n    <small id="{{id_name}}_help" class="form-text text-muted">{{help_text}}</small>\n</div>',e);this.element=$(o),this.element.find("#"+n+"_action_btn").on("click",function(e){var t=$(this);l.state.CurrentSession.send_message({event:"callback",task_id:t.data("callbackid"),data:null})});var i=this.element.find("#"+n);i.on("blur",function(e){t.send_value_listener(t,e)});var a={action:"",type:"",label:"",invalid_feedback:"",valid_feedback:"",help_text:"",options:"",datalist:"",multiple:""};for(var r in this.spec)r in a||i.attr(r,this.spec[r]);return this.element}},{key:"update_input",value:function(e){var t=e.attributes;this.update_input_helper(-1,t)}},{key:"get_value",value:function(){return this.element.find("input").val()}}]),c);function c(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e,t,n))}(n.Input=r).accept_input_types=["text","password","number","color","date","range","time","email","url"]},{"../../state":20,"../../utils":22,"./base":11}],16:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./base"),c=e("../../utils"),r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,a.InputItem),o(s,[{key:"create_element",value:function(){var t=this,e=c.deep_copy(this.spec),n=e.name+"-"+Math.floor(Math.random()*Math.floor(9999));e.id_name=n;var o=Mustache.render('\n<div class="form-group">\n    {{#label}}<label for="{{id_name}}">{{label}}</label>{{/label}}\n    <select id="{{id_name}}" aria-describedby="{{id_name}}_help" class="form-control" {{#multiple}}multiple{{/multiple}}>\n        {{#options}}\n        <option {{#selected}}selected{{/selected}} {{#disabled}}disabled{{/disabled}}>{{label}}</option>\n        {{/options}}\n    </select>\n    <div class="invalid-feedback">{{invalid_feedback}}</div>\n    <div class="valid-feedback">{{valid_feedback}}</div>\n    <small id="{{id_name}}_help" class="form-text text-muted">{{help_text}}</small>\n</div>',e);this.element=$(o);for(var i=this.element.find("#"+n),a=i.find("option"),r=0;r<e.options.length;r++)a.eq(r).val(JSON.stringify(e.options[r].value));i.on("blur",function(e){t.send_value_listener(t,e)});var s={type:"",label:"",invalid_feedback:"",valid_feedback:"",help_text:"",options:"",datalist:"",multiple:""};for(var l in this.spec)l in s||i.attr(l,this.spec[l]);return this.element}},{key:"update_input",value:function(e){var t=e.attributes;this.update_input_helper(-1,t)}},{key:"get_value",value:function(){var e=this.element.find("select").val();if(this.spec.multiple){var t=[],n=!0,o=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value;t.push(JSON.parse(s))}}catch(e){o=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw i}}return t}return JSON.parse(e)}}]),s);function s(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t,n))}(n.Select=r).accept_input_types=["select"]},{"../../utils":22,"./base":11}],17:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./base"),s=e("../../utils"),l=e("../../state"),r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,a.InputItem),o(c,[{key:"create_element",value:function(){var e=s.deep_copy(this.spec),t=e.name+"-"+Math.floor(Math.random()*Math.floor(9999));e.id_name=t;var n=Mustache.render('\n<div class="form-group">\n    {{#label}}<label for="{{id_name}}">{{label}}</label>{{/label}}\n    <textarea id="{{id_name}}" aria-describedby="{{id_name}}_help" rows="{{rows}}" class="form-control" >{{value}}</textarea>\n    <div class="invalid-feedback">{{invalid_feedback}}</div>  \x3c!-- input 添加 is-invalid 类 --\x3e\n    <div class="valid-feedback">{{valid_feedback}}</div> \x3c!-- input 添加 is-valid 类 --\x3e\n    <small id="{{id_name}}_help" class="form-text text-muted">{{help_text}}</small>\n</div>',e);this.element=$(n);var o=this.element.find("#"+t),i=s.make_set(["value","type","label","invalid_feedback","valid_feedback","help_text","rows","code"]);for(var a in this.spec)a in i||o.attr(a,this.spec[a]);if(e.code){for(var r in CodeMirror.modeURL=l.config.codeMirrorModeURL,this.spec.code)this.code_mirror_config[r]=this.spec.code[r];(this.spec.readonly||this.spec.disabled)&&(this.code_mirror_config.readOnly="nocursor"),this.code_mirror_config.theme&&"base16-light"!==this.code_mirror_config.theme&&c.load_codemirror_theme(this.code_mirror_config.theme)}return this.element}},{key:"update_input",value:function(e){var t=e.attributes;this.update_input_helper.call(this,-1,t)}},{key:"get_value",value:function(){return this.element.find("textarea").val()}},{key:"after_show",value:function(e){e&&this.spec.code&&(this.code_mirror=CodeMirror.fromTextArea(this.element.find("textarea")[0],this.code_mirror_config),CodeMirror.autoLoadMode(this.code_mirror,this.code_mirror_config.mode),this.code_mirror.setSize(null,20*this.spec.rows))}}],[{key:"load_codemirror_theme",value:function(e,t){var n,o,i=1<arguments.length&&void 0!==t?t:l.config.codeMirrorThemeURL,a="codemirror_theme_"+e;document.getElementById(a)||(n=document.getElementsByTagName("head")[0],(o=document.createElement("link")).id=a,o.rel="stylesheet",o.type="text/css",o.href=i.replace("%N",e),o.media="all",n.appendChild(o))}}]),c);function c(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e,t,n));return o.code_mirror=null,o.code_mirror_config={theme:"base16-light",mode:"python",lineNumbers:!0,indentUnit:4,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0},o}(n.Textarea=r).accept_input_types=["textarea"]},{"../../state":20,"../../utils":22,"./base":11}],18:[function(e,t,n){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../utils"),o={handle_type:"text",get_element:function(e){var t=e.inline?$("<span></span>"):$("<p></p>");e.content=e.content.replace(/ /g," ");for(var n=(e.content||"").split("\n"),o=0;o<n.length-1;o++)t.append(document.createTextNode(n[o])).append("<br/>");return t.append(document.createTextNode(n[n.length-1])),t}},a=new Mditor.Parser;function r(e){var t=$.parseHTML(e,null,!0);return 1!=t.length?$(document.createElement("div")).append(t):$(t[0])}var s=[o,{handle_type:"markdown",get_element:function(e){return $(a.parse(e.content))}},{handle_type:"html",get_element:function(e){return r(e.content)}},{handle_type:"buttons",get_element:function(e){e.color=e.link?"link":"primary";for(var t=Mustache.render('<div>{{#buttons}} \n                                <button class="btn {{#color}}btn-{{color}}{{/color}}{{#small}} btn-sm{{/small}}">{{label}}</button> \n                          {{/buttons}}</div>',e),n=$(t),o=n.find("button"),i=0;i<e.buttons.length;i++)o.eq(i).attr("onclick","WebIO.pushData("+JSON.stringify(e.buttons[i].value)+', "'+e.callback_id+'")');return n}},{handle_type:"file",get_element:function(t){var e='<div><button type="button" class="btn btn-link">'+t.name+"</button></div>",n=$(e),o=i.b64toBlob(t.content);return n.on("click","button",function(e){saveAs(o,t.name,{},!1)}),n}},{handle_type:"table",get_element:function(e){var t=[];for(var n in e.data){t.push([]);var o=e.data[n];for(var i in o){var a=e.data[n][i];"object"!==(void 0===a?"undefined":c(a))&&(a={type:"text",content:a,inline:!0}),t[n].push(Object.assign({data:m(a)},e.span[n+","+i]||{}))}}var r=t[0],s=t.slice(1),l=Mustache.render('\n<table>\n    <tr>\n        {{#header}} \n        <th{{#col}} colspan="{{col}}"{{/col}}{{#row}} rowspan="{{row}}"{{/row}}>{{& data}}</th> \n        {{/header}}\n    </tr>\n      {{#tdata}} \n      <tr>\n        {{# . }} \n        <td{{#col}} colspan="{{col}}"{{/col}}{{#row}} rowspan="{{row}}"{{/row}}>{{& data}}</td> \n        {{/ . }} \n      </tr>\n      {{/tdata}}\n    \n</table>',{header:r,tdata:s});return $(l)}},{handle_type:"custom_widget",get_element:function(e){return e.data.pywebio_output_parse=function(){return this.type?m(this):m({type:"text",content:this,inline:!0})},r(Mustache.render(e.template,e.data))}}],l={},u=!0,d=!1,p=void 0;try{for(var f,h=s[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var v=f.value;l[v.handle_type]=v}}catch(e){d=!0,p=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw p}}function _(e){if(!(e.type in l))throw Error("Unknown type in getWidgetElement() :"+e.type);var t,n=l[e.type].get_element(e);return e.style&&(t=n.attr("style")||"",n.attr({style:t+e.style})),n}function m(t){var e="";try{var n=_(t),o=!0,i=!1,a=void 0;try{for(var r,s=n[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){e+=r.value.outerHTML||""}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}}catch(e){console.error("Get sub widget html error,",e,t)}return e}n.getWidgetElement=_,n.outputSpecToHtml=m},{"../utils":22}],19:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./utils"),s=e("./state"),l=(o(c,[{key:"on_session_create",value:function(e){this._on_session_create=e}},{key:"on_session_close",value:function(e){this._on_session_close=e}},{key:"on_server_message",value:function(e){this._on_server_message=e}},{key:"start_session",value:function(e){var n=0<arguments.length&&void 0!==e&&e;this.debug=n,this.ws=new WebSocket(this.ws_api),this.ws.onopen=this._on_session_create,this.ws.onclose=this._on_session_close;var o=this;this.ws.onmessage=function(e){var t=JSON.parse(e.data);n&&console.info(">>>",JSON.parse(e.data)),o._on_server_message(t)}}},{key:"start_onprogress",value:function(t){var n=this,o=this.ws.bufferedAmount,i=setInterval(function(){var e=o-n.ws.bufferedAmount;t(e,o),0==n.ws.bufferedAmount&&clearInterval(i)},200)}},{key:"send_message",value:function(e,t){return this.closed()?r.error_alert("与服务器连接已断开，请刷新页面重新操作"):null===this.ws?console.error("WebSocketWebIOSession.ws is null when invoke WebSocketWebIOSession.send_message. Please call WebSocketWebIOSession.start_session first"):(this.ws.send(JSON.stringify(e)),t&&this.start_onprogress(t),void(this.debug&&console.info("<<<",e)))}},{key:"close_session",value:function(){this._closed=!0,this._on_session_close.call(this.ws,null);try{this.ws.close()}catch(e){}}},{key:"closed",value:function(){return this._closed||this.ws.readyState===WebSocket.CLOSED||this.ws.readyState===WebSocket.CLOSING}}]),c);function c(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"index";a(this,c),this.ws_api=e,this._on_session_create=function(){},this._on_session_close=function(){},this._on_server_message=function(){},this.ws=null,this.debug=!1,this._closed=!1;var n,o=new URL(e);"wss:"!==o.protocol&&"ws:"!==o.protocol&&(n=o.protocol||window.location.protocol,o.protocol=n.replace("https","wss").replace("http","ws")),o.search="?app="+t,this.ws_api=o.href}n.WebSocketSession=l;var u=(o(d,[{key:"on_session_create",value:function(e){this._on_session_create=e}},{key:"on_session_close",value:function(e){this._on_session_close=e}},{key:"on_server_message",value:function(e){this._on_server_message=e}},{key:"start_session",value:function(e){var t=this,n=0<arguments.length&&void 0!==e&&e;this.debug=n,this.pull(),this.interval_pull_id=setInterval(function(){t.pull()},this.pull_interval_ms)}},{key:"pull",value:function(){var o=this;$.ajax({type:"GET",url:this.api_url,contentType:"application/json; charset=utf-8",dataType:"json",headers:{"webio-session-id":this.webio_session_id},success:function(e,t,n){o._on_request_success(e,t,n),o._on_session_create()},error:function(){console.error("Http pulling failed")}})}},{key:"_on_request_success",value:function(e,t,n){var o=n.getResponseHeader("webio-session-id");o&&(this.webio_session_id=o);var i=!0,a=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;this.debug&&console.info(">>>",c),this._on_server_message(c)}}catch(e){a=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw r}}}},{key:"send_message",value:function(e,t){if(this.closed())return r.error_alert("与服务器连接已断开，请刷新页面重新操作");this.debug&&console.info("<<<",e),$.ajax({type:"POST",url:this.api_url,data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",headers:{"webio-session-id":this.webio_session_id},success:this._on_request_success.bind(this),xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&t&&t(e.loaded,e.total)},!1),e},error:function(){console.error("Http push event failed, event data: %s",e),r.error_alert("连接服务器失败!")}})}},{key:"close_session",value:function(){this._closed=!0,this._on_session_close(),clearInterval(this.interval_pull_id)}},{key:"closed",value:function(){return this._closed}},{key:"change_pull_interval",value:function(e){var t=this;clearInterval(this.interval_pull_id),this.pull_interval_ms=e,this.interval_pull_id=setInterval(function(){t.pull()},this.pull_interval_ms)}}]),d);function d(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"index",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e3;a(this,d),this.api_url=e,this.pull_interval_ms=n,this.interval_pull_id=null,this.debug=!1,this._closed=!1,this._on_session_create=function(){},this._on_session_close=function(){},this._on_server_message=function(){};var o=new URL(e,window.location.href);o.search="?app="+t,this.api_url=o.href}n.HttpSession=u,n.is_http_backend=function(n){var e=new URL(n),t=e.protocol||window.location.protocol;return e.protocol=t.replace("wss","https").replace("ws","http"),n=e.href,new Promise(function(t,e){$.get(n,{test:1},void 0,"html").done(function(e){t("ok"===e)}).fail(function(e){t(!1)})})},n.pushData=function(e,t){if(null===s.state.CurrentSession)return console.error("can't invoke PushData when WebIOController is not instantiated");s.state.CurrentSession.send_message({event:"callback",task_id:t,data:e})}},{"./state":20,"./utils":22}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.state={AutoScrollBottom:!1,CurrentSession:null,ShowDuration:200},n.config={codeMirrorModeURL:"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/%N/%N.min.js",codeMirrorThemeURL:"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/theme/%N.min.css",outputAnimation:!0,httpPullInterval:1e3,debug:!1}},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=!1,a=$("#input-container"),r=$("#input-cards"),s=$("#end-space");function o(){i=!1,a.hasClass("fixed")&&a.removeClass("fixed"),a.height("unset"),s.height(0)}function l(){var e=r.height()+80;return 300<e?300:e}function c(e){var t;e?(t=l(),s.height(t-40),a.height(t),a.addClass("fixed")):(a.removeClass("fixed"),s.height(0),a.height("unset"))}function u(e){var t=a.height()+e;t>=r.height()?t=r.height():t<=l()-80&&(t=l()-80),a.height(t),s.height(t-40)}n.show_input=function(){o(),i=!0,$(window).height()-a[0].getBoundingClientRect().top<l()-40&&c(!0)},n.close_input=o,$(function(){a=$("#input-container"),r=$("#input-cards"),s=$("#end-space");var o=0;$(window).on("scroll",function(){var e=window.pageYOffset||document.documentElement.scrollTop,t=e<o,n=o<e;a.hasClass("fixed")?$(window).scrollTop()+window.innerHeight>$(document).height()-50&&n&&(c(!1),e=window.pageYOffset||document.documentElement.scrollTop):$(window).height()-a[0].getBoundingClientRect().top<l()-40&&t&&i&&(c(!0),e=window.pageYOffset||document.documentElement.scrollTop),o=e<=0?0:e}),a[0].addEventListener("wheel",function(e){a.hasClass("fixed")&&(e.preventDefault(),u(parseInt(e.deltaY)))});var n=-1;a[0].addEventListener("touchstart",function(e){1<e.changedTouches.length||(n=e.changedTouches[0].screenY)}),a[0].addEventListener("touchmove",function(e){var t;a.hasClass("fixed")&&(1<e.changedTouches.length||(e.preventDefault(),t=n-e.changedTouches[0].screenY,n=e.changedTouches[0].screenY,u(t)))})})},{}],22:[function(e,t,n){"use strict";var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0});var a=(o(r,[{key:"push",value:function(e,t){if(e in this.map)return console.error("LRUMap: key:%s already in map",e);this.keys.push(e),this.map[e]=t}},{key:"get_value",value:function(e){return this.map[e]}},{key:"get_top",value:function(){var e=this.keys[this.keys.length-1];return this.map[e]}},{key:"set_value",value:function(e,t){if(!(e in this.map))return console.error("LRUMap: key:%s not in map when call `set_value`",e);this.map[e]=t}},{key:"move_to_top",value:function(e){var t=this.keys.indexOf(e);if(!(-1<t))return console.error("LRUMap: key:%s not in map when call `move_to_top`",e);this.keys.splice(t,1),this.keys.push(e)}},{key:"remove",value:function(e){if(!(e in this.map))return console.error("LRUMap: key:%s not in map when call `remove`",e);delete this.map[e],this.keys.splice(this.keys.indexOf(e),1)}}]),r);function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.keys=[],this.map={}}n.LRUMap=a,n.b64toBlob=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"application/octet-stream",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:512,o=atob(e),i=[],a=0;a<o.length;a+=n){for(var r=o.slice(a,a+n),s=new Array(r.length),l=0;l<r.length;l++)s[l]=r.charCodeAt(l);var c=new Uint8Array(s);i.push(c)}return new Blob(i,{type:t})},n.make_set=function(e){var t={},n=!0,o=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){t[a.value]=""}}catch(e){o=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw i}}return t},n.deep_copy=function(e){return JSON.parse(JSON.stringify(e))},n.body_scroll_to=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top",n=arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,i=null;"top"===t?i=e.offset().top:"middle"===t?i=e.offset().top+.5*e[0].clientHeight-.5*$(window).height():"bottom"===t&&(i=e[0].clientHeight+e.offset().top-$(window).height());var a=$("body,html"),r=Math.abs(a.scrollTop()-i-o);null!==i&&a.stop().animate({scrollTop:i+o},Math.min(r,500)+100,n)},n.box_scroll_to=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",o=arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=null;"top"===n?a=e[0].getBoundingClientRect().top-t[0].getBoundingClientRect().top:"middle"===n?a=e[0].getBoundingClientRect().top-t[0].getBoundingClientRect().top-.5*t.height()+.5*e.height():"bottom"===n&&(a=e[0].getBoundingClientRect().bottom-t[0].getBoundingClientRect().bottom);var r=Math.min(Math.abs(a+i),500)+100;null!==a&&t.stop().animate({scrollTop:t.scrollTop()+a+i},r,o)},n.randomid=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*o));return t},n.openApp=function(e,t){var n=new URL(window.location.href);n.searchParams.set("app",e),t?window.open(n.href):window.location.href=n.href},n.error_alert=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1.5;Toastify({text:Mustache.escape(e),duration:1e3*t,gravity:"top",position:"center",backgroundColor:"#e53935"}).showToast()}},{}]},{},[9]);