{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/handlers/base.ts","src/handlers/download.ts","src/handlers/env.ts","src/handlers/input.ts","src/handlers/output.ts","src/handlers/popup.ts","src/handlers/script.ts","src/handlers/toast.ts","src/main.ts","src/models/input/actions.ts","src/models/input/base.ts","src/models/input/checkbox_radio.ts","src/models/input/file.ts","src/models/input/index.ts","src/models/input/input.ts","src/models/input/select.ts","src/models/input/textarea.ts","src/models/output.ts","src/session.ts","src/state.ts","src/ui.ts","src/utils.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","CloseHandler","this","session","close_session","_classCallCheck","accept_command","CommandDispatcher","msg","command","command2handler","handle_message","_len","arguments","handlers","Array","_key","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","h","value","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","cmd","err","return","utils_1","DownloadHandler","blob","b64toBlob","spec","content","saveAs","name","session_1","state_1","EnvSettingHandler","title","document","auto_scroll_bottom","state","AutoScrollBottom","output_animation","config","outputAnimation","http_pull_interval","CurrentSession","HttpSession","change_pull_interval","input_1","ui_1","InputHandler","setTimeout","curr_card","$","style","height","width","show_input","old_ctrls","form_ctrls","get_top","after_show","focus","task_id","old_ctrl","_this","ctrls","get_value","ctrl","element","show","ShowDuration","_after_show_form","move_to_top","hide","_this2","target_ctrls","push","make_set","FormController","container_elem","append","create_element","after_add_to_dom","_activate_form","console","error","dispatch_ctrl_message","deleted","pop","remove","close_input","LRUMap","that","html","Mustache","render","label","cancelable","find","on","prop","send_message","event","data","inputs","type","buttons","body","idx","input_spec","input_items","item","name2input","preventDefault","check_valid","error_alert","each","on_process","make_progress","elem","bar","loaded","total","progress","toFixed","attr","text","target_name","update_input","show_count","cls","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","accept_input_types","_step4","_iterator4","all_input_items","_iteratorNormalCompletion4","register_inputitem","output_1","DISPLAY_NONE_TAGS","OutputHandler","body_scroll_to","output_to_root","getWidgetElement","scope","indexOf","tagName","toLowerCase","position","prepend","con","pos","children","eq","insertBefore","insertAfter","fadeIn","complete","scroll_bottom","handle_output_ctl","set_scope","container","old","if_exist","empty","target","removed","valid","clear","clear_before","prevAll","clear_after","scroll_to","clear_range","id","warn","container_parent","parent","PopupHandler","current_elem","modal","get_element","closable","implicit_close","Object","assign","large","size","small","pywebio_output_parse","outputSpecToHtml","inline","ScriptHandler","script","args","arg_names","arg_vals","key","Function","prototype","bind","apply","concat","ToastHandler","toast","Toastify","escape","duration","close","gravity","backgroundColor","color","stopOnFocus","onClick","callback_id","hideToast","showToast","base_1","popup_1","script_1","download_1","toast_1","env_1","window","WebIO","startWebIOClient","output_container_elem","input_container_elem","app_name","uri","backend_addr","URLSearchParams","location","search","get","URL","href","is_http_backend","then","http_backend","webio_session","on_session_close","output_ctrl","input_ctrl","popup_ctrl","close_ctrl","script_ctrl","download_ctrl","toast_ctrl","env_ctrl","dispatcher","on_server_message","dispatch_message","set_up_session","httpPullInterval","WebSocketSession","start_session","debug","sendMessage","openApp","pushData","Actions","InputItem","b","btns","val","JSON","stringify","btn","submit_value","parse","parents","trigger","attributes","index","target_value","update_input_helper","_possibleConstructorReturn","__proto__","getPrototypeOf","input_item","event_name","input_idx","attr2selector","invalid_feedback","valid_feedback","help_text","attribute","class_name","input_elem","valid_status","removeClass","addClass","CheckboxRadio","deep_copy","id_name_prefix","Math","floor","random","options","_idx","ignore_keys","selected","_idx2","raw_val","value_arr","serializeArray","res","log","_typeof","File","id_name","placeholder","data_url_value","total_size","file","files","_loop","fr","FileReader","max_size","_formate_size","max_total_size","v","onload","filename","mime_type","last_modified","lastModified","dataurl","result","readAsDataURL","_ret","_arr","_i","s","bsCustomFileInput","init","actions_1","checkbox_radio_1","textarea_1","file_1","select_1","Input","Textarea","Select","datalist","send_value_listener","action","multiple","opts","k","CodeMirror","modeURL","codeMirrorModeURL","code_mirror_config","readonly","disabled","theme","load_codemirror_theme","first_show","code_mirror","fromTextArea","autoLoadMode","mode","setSize","rows","head","link","url_tpl","codeMirrorThemeURL","cssId","getElementById","getElementsByTagName","createElement","rel","replace","media","appendChild","lineNumbers","indentUnit","styleActiveLine","matchBrackets","lineWrapping","Text","handle_type","lines","split","createTextNode","_md_parser","Mditor","Parser","parseHtml","html_str","nodes","parseHTML","all_widgets","table_data","row_id","row","col_id","_data","span","header","slice","tdata","template","type2widget","w","old_style","outerHTML","callback","_on_session_create","_on_session_close","_on_server_message","ws","WebSocket","ws_api","onopen","onclose","onmessage","evt","info","onprogress","bufferedAmount","onprogressID","setInterval","clearInterval","closed","send","start_onprogress","_closed","readyState","CLOSED","CLOSING","protocol","url","pull","interval_pull_id","pull_interval_ms","ajax","api_url","contentType","dataType","headers","webio-session-id","webio_session_id","success","textStatus","jqXHR","_on_request_success","sid","getResponseHeader","xhr","XMLHttpRequest","upload","addEventListener","lengthComputable","new_interval","_this3","Promise","resolve","reject","test","fail","has_input","input_panel","input_cards","end_space","hasClass","input_min_fixed_height","now_height","toggle_input_panel_style","fixed","min","move_input_panel","step","new_height","getBoundingClientRect","top","lastScrollTop","st","pageYOffset","documentElement","scrollTop","downmove","upmove","innerHeight","parseInt","deltaY","last_y","changedTouches","screenY","variation","map","keys","top_key","splice","b64Data","sliceSize","byteCharacters","atob","byteArrays","offset","byteNumbers","charCodeAt","byteArray","Uint8Array","Blob","arr","set","obj","clientHeight","speed","abs","stop","animate","box_scroll_to","scrollTopOffset","bottom","randomid","characters","charactersLength","charAt","new_window","searchParams","open"],"mappings":"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","file":"pywebio.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import {Command, Session} from \"../session\";\n\n\nexport interface CommandHandler {\n    accept_command: string[],\n\n    handle_message(msg: Command): void\n}\n\nexport class CloseHandler implements CommandHandler {\n    accept_command: string[] = ['close_session'];\n\n    constructor(readonly session: Session) {\n    }\n\n    handle_message(msg: Command) {\n        this.session.close_session();\n    }\n}\n\nexport class CommandDispatcher {\n    command2handler: { [cmd: string]: CommandHandler } = {};\n\n    constructor(...handlers: CommandHandler[]) {\n        for (let h of handlers) {\n            for (let cmd of h.accept_command) {\n                if (cmd in this.command2handler)\n                    throw  new Error(`Conflict command handler: both ${this.command2handler[cmd]} and ${h} accepts '${cmd}' command`);\n                this.command2handler[cmd] = h;\n            }\n        }\n    }\n\n    dispatch_message(msg: Command): boolean {\n        if (msg.command in this.command2handler) {\n            this.command2handler[msg.command].handle_message(msg);\n            return true;\n        }\n        return false\n    }\n}","import {Command} from \"../session\";\nimport {CommandHandler} from \"./base\";\nimport {b64toBlob} from \"../utils\";\n\nexport class DownloadHandler implements CommandHandler {\n    accept_command: string[] = ['download'];\n\n    constructor() {\n    }\n\n    handle_message(msg: Command) {\n        let blob = b64toBlob(msg.spec.content);\n        saveAs(blob, msg.spec.name, {}, false);\n    }\n}","import {Command, HttpSession} from \"../session\";\nimport {CommandHandler} from \"./base\";\nimport {config, state} from \"../state\";\n\nexport class EnvSettingHandler implements CommandHandler {\n    accept_command: string[] = ['set_env'];\n\n    constructor() {\n    }\n\n    handle_message(msg: Command) {\n        let spec = msg.spec;\n        if (spec.title !== undefined) {\n            document.title = spec.title;\n        }\n\n        if (spec.auto_scroll_bottom !== undefined)\n            state.AutoScrollBottom = spec.auto_scroll_bottom;\n\n        if (spec.output_animation !== undefined) {\n            config.outputAnimation = spec.output_animation;\n        }\n\n        if (spec.http_pull_interval !== undefined) {\n            if (state.CurrentSession instanceof HttpSession)\n                state.CurrentSession.change_pull_interval(spec.http_pull_interval);\n        }\n    }\n}","import {Command, Session} from \"../session\";\nimport {error_alert, LRUMap, make_set} from \"../utils\";\nimport {InputItem} from \"../models/input/base\"\nimport {state} from '../state'\nimport {all_input_items} from \"../models/input\"\nimport {CommandHandler} from \"./base\"\nimport {close_input, show_input} from \"../ui\";\n\n/*\n* 整个输入区域的控制类\n* 管理当前活跃和非活跃的表单\n* */\nexport class InputHandler implements CommandHandler {\n    accept_command: string[] = ['input', 'input_group', 'update_input', 'destroy_form'];\n\n    session: Session;\n    private form_ctrls: LRUMap;\n    private readonly container_elem: JQuery;\n\n    constructor(session: Session, container_elem: JQuery) {\n        this.session = session;\n        this.container_elem = container_elem;\n        this.form_ctrls = new LRUMap(); // task_id -> stack of FormGroupController\n    }\n\n    private _after_show_form() {\n        // 解决表单显示后动态添加内容，表单宽高不变的问题\n        setTimeout(() => {\n            let curr_card = $('#input-cards > .card')[0];\n            curr_card.style.height = \"unset\";\n            curr_card.style.width = \"unset\";\n        }, 50);\n\n        show_input();\n\n        let old_ctrls = this.form_ctrls.get_top();\n        if (old_ctrls)\n            old_ctrls[old_ctrls.length - 1].after_show();\n\n        $('[auto_focus=\"true\"]').focus();\n    };\n\n    // hide old_ctrls显示的表单，激活 task_id 对应的表单\n    // 需要保证 task_id 对应有表单\n    private _activate_form(task_id: string, old_ctrl: InputItem) {\n        let ctrls = this.form_ctrls.get_value(task_id);\n        let ctrl = ctrls[ctrls.length - 1];\n        if (ctrl === old_ctrl || old_ctrl === undefined) {\n            return ctrl.element.show(state.ShowDuration, () => {\n                this._after_show_form()\n            });\n        }\n        this.form_ctrls.move_to_top(task_id);\n        old_ctrl.element.hide(100, () => {\n            // ctrl.element.show(100);\n            // 需要在回调中重新获取当前前置表单元素，因为100ms内可能有变化\n            let t = this.form_ctrls.get_top();\n            if (t) t[t.length - 1].element.show(state.ShowDuration, () => {\n                this._after_show_form()\n            });\n        });\n    };\n\n\n    /*\n    * 每次函数调用返回后，this.form_ctrls.get_top()的栈顶对应的表单为当前活跃表单\n    * */\n    handle_message(msg: Command) {\n        let old_ctrls = this.form_ctrls.get_top();\n        let old_ctrl = old_ctrls && old_ctrls[old_ctrls.length - 1];\n        let target_ctrls = this.form_ctrls.get_value(msg.task_id);\n        if (target_ctrls === undefined) {\n            this.form_ctrls.push(msg.task_id, []);\n            target_ctrls = this.form_ctrls.get_value(msg.task_id);\n        }\n\n        // 创建表单\n        if (msg.command in make_set(['input', 'input_group'])) {\n            let ctrl = new FormController(this.session, msg.task_id, msg.spec);\n            target_ctrls.push(ctrl);\n            this.container_elem.append(ctrl.create_element());\n            ctrl.after_add_to_dom();\n            this._activate_form(msg.task_id, old_ctrl);\n        } else if (msg.command in make_set(['update_input'])) {\n            // 更新表单\n            if (target_ctrls.length === 0) {\n                return console.error('No form to current message. task_id:%s', msg.task_id);\n            }\n            target_ctrls[target_ctrls.length - 1].dispatch_ctrl_message(msg.spec);\n            // 表单前置 removed\n            // this._activate_form(msg.task_id, old_ctrl);\n        } else if (msg.command === 'destroy_form') {\n            if (target_ctrls.length === 0) {\n                return console.error('No form to current message. task_id:%s', msg.task_id);\n            }\n            let deleted = target_ctrls.pop() as FormController;\n            if (target_ctrls.length === 0)\n                this.form_ctrls.remove(msg.task_id);\n\n            // 销毁的是当前显示的form\n            if (old_ctrls === target_ctrls) {\n                deleted.element.hide(100, () => {\n                    deleted.element.remove();\n                    close_input();\n\n                    let t = this.form_ctrls.get_top();\n                    if (t) t[t.length - 1].element.show(state.ShowDuration, () => {\n                        this._after_show_form()\n                    });\n                });\n            } else {\n                deleted.element.remove();\n                close_input();\n            }\n        }\n    }\n}\n\n\n/*\n* 表单控制器\n* */\nclass FormController {\n    static input_items: { [input_type: string]: typeof InputItem } = {};\n\n    session: Session;\n\n    element: JQuery = null;\n\n    private task_id: string;\n    private spec: any;\n    // name -> input_controller\n    private name2input: { [i: string]: InputItem } = {};\n    private show_count: number = 0;\n\n    public static register_inputitem(cls: typeof InputItem) {\n        for (let type of cls.accept_input_types) {\n            if (type in this.input_items)\n                throw new Error(`duplicated accept_input_types:[${type}] in ${cls} and ${this.input_items[type]}`);\n            this.input_items[type] = cls;\n        }\n    }\n\n    constructor(session: Session, task_id: string, spec: any) {\n        this.session = session;\n        this.task_id = task_id;\n        this.spec = spec;\n\n        // this.create_element();\n    }\n\n\n    create_element(): JQuery {\n        let tpl = `\n            <div class=\"card\" style=\"display: none\">\n                <h5 class=\"card-header\">{{label}}</h5>\n                <div class=\"card-body\">\n                    <form>\n                        <div class=\"input-container\"></div>\n                        <div class=\"ws-form-submit-btns\">\n                            <button type=\"submit\" class=\"btn btn-primary\">提交</button>\n                            <button type=\"reset\" class=\"btn btn-warning\">重置</button>\n                            {{#cancelable}}<button type=\"button\" class=\"pywebio_cancel_btn btn btn-danger\">取消</button>{{/cancelable}}\n                        </div>\n                    </form>\n                </div>\n            </div>`;\n        let that = this;\n\n        const html = Mustache.render(tpl, {label: this.spec.label, cancelable: this.spec.cancelable});\n        let element = $(html);\n\n        element.find('.pywebio_cancel_btn').on('click', function (e) {\n            element.find('button').prop(\"disabled\", true);\n            that.session.send_message({\n                event: \"from_cancel\",\n                task_id: that.task_id,\n                data: null\n            });\n        });\n\n        // 隐藏默认的\"提交\"/\"重置\"按钮\n        if (this.spec.inputs.length && this.spec.inputs[this.spec.inputs.length - 1].type === 'actions') {\n            for (let btn of this.spec.inputs[this.spec.inputs.length - 1].buttons) {\n                if (btn.type === 'submit') {\n                    element.find('.ws-form-submit-btns').hide();\n                    break;\n                }\n            }\n        }\n\n        // 输入控件创建\n        let body = element.find('.input-container');\n        for (let idx in this.spec.inputs) {\n            let input_spec = this.spec.inputs[idx];\n            if (!(input_spec.type in FormController.input_items))\n                throw new Error(`Unknown input type '${input_spec.type}'`);\n            let item_class = FormController.input_items[input_spec.type];\n            let item = new item_class(this.session, this.task_id, input_spec);\n            this.name2input[input_spec.name] = item;\n\n            body.append(item.create_element());\n        }\n\n        // 事件绑定\n        element.on('submit', 'form', function (e) {\n            e.preventDefault(); // avoid to execute the actual submit of the form.\n\n            for (let name in that.name2input)\n                if (!that.name2input[name].check_valid())\n                    return error_alert('输入项存在错误，请消除错误后再提交');\n\n            let data: { [i: string]: any } = {};\n            $.each(that.name2input, (name, ctrl) => {\n                data[name] = ctrl.get_value();\n            });\n            let on_process = undefined;\n            // 在有文件上传的表单中显示进度条\n            for (let item of that.spec.inputs) {\n                if (item.type == 'file') {\n                    on_process = that.make_progress();\n                    break;\n                }\n            }\n            element.find('button').prop(\"disabled\", true);\n            that.session.send_message({\n                event: \"from_submit\",\n                task_id: that.task_id,\n                data: data\n            }, on_process);\n        });\n\n        this.element = element;\n        return element;\n    };\n\n    // 显示提交进度条，返回进度更新函数\n    make_progress() {\n        let html = `<div class=\"progress\" style=\"margin-top: 4px;\">\n                        <div class=\"progress-bar bg-info progress-bar-striped progress-bar-animated\" role=\"progressbar\"\n                             style=\"width: 0%;\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\">0%\n                        </div>\n                    </div>`;\n        let elem = $(html);\n        this.element.find('.card-body').append(elem);\n\n        let bar = elem.find('.progress-bar');\n        return function (loaded: number, total: number) {\n            let progress = \"\" + (100.0 * loaded / total).toFixed(1);\n            bar[0].style.width = progress + \"%\";\n            bar.attr(\"aria-valuenow\", progress);\n            bar.text(progress + \"%\");\n        }\n    };\n\n    dispatch_ctrl_message(spec: any) {\n        // 恢复原本可点击的按钮\n        this.element.find('button:not([data-pywebio-disabled])').prop(\"disabled\", false);\n        // 移除上传进度条\n        this.element.find('.progress').remove();\n\n        if (!(spec.target_name in this.name2input)) {\n            return console.error('Can\\'t find input[name=%s] element in curr form!', spec.target_name);\n        }\n\n        this.name2input[spec.target_name].update_input(spec);\n    };\n\n    // 在表单加入DOM树后，触发输入项的on_add_to_dom回调\n    after_add_to_dom() {\n        for (let name in this.name2input) {\n            this.name2input[name].after_add_to_dom();\n        }\n    }\n\n    // 在表单被显示后，触发输入项的after_show回调\n    after_show() {\n        for (let name in this.name2input) {\n            this.name2input[name].after_show(this.show_count === 0);\n        }\n        this.show_count += 1;\n    }\n}\n\nfor (let item of all_input_items)\n    FormController.register_inputitem(item);","import {Command, Session} from \"../session\";\nimport {config, state} from '../state'\nimport {body_scroll_to} from \"../utils\";\n\nimport {getWidgetElement} from \"../models/output\"\nimport {CommandHandler} from \"./base\";\n\nconst DISPLAY_NONE_TAGS = ['script', 'style'];\n\nexport class OutputHandler implements CommandHandler {\n    session: Session;\n\n    accept_command = ['output', 'output_ctl'];\n\n    private readonly container_parent: JQuery;\n    private readonly container_elem: JQuery;\n\n    constructor(session: Session, container_elem: JQuery) {\n        this.session = session;\n        this.container_elem = container_elem;\n        this.container_parent = this.container_elem.parent();\n    }\n\n    scroll_bottom() {\n        body_scroll_to($('.pywebio'), 'bottom', null, 15);\n    };\n\n    handle_message(msg: Command) {\n        let output_to_root = false;\n        if (msg.command === 'output') {\n            let elem;\n            try {\n                elem = getWidgetElement(msg.spec);\n            } catch (e) {\n                return console.error(`Handle command error, command: ${msg}, error:${e}`);\n            }\n\n            let container_elem = $(msg.spec.scope);\n\n            if (config.outputAnimation && DISPLAY_NONE_TAGS.indexOf(elem[0].tagName.toLowerCase()) == -1 && container_elem.length == 1) elem.hide();\n\n            if (container_elem.length === 0)\n                return console.error(`Scope '${msg.spec.scope}' not found`);\n\n            if (!msg.spec.scope || msg.spec.scope === '#pywebio-scope-ROOT') output_to_root = true;\n\n            if (msg.spec.position === 0)\n                container_elem.prepend(elem);\n            else if (msg.spec.position === -1)\n                container_elem.append(elem);\n            else {\n                for (let con of container_elem) {\n                    let pos = $(con.children).eq(msg.spec.position);\n                    if (msg.spec.position >= 0)\n                        elem.insertBefore(pos);\n                    else\n                        elem.insertAfter(pos);\n                }\n            }\n\n            if (DISPLAY_NONE_TAGS.indexOf(elem[0].tagName.toLowerCase()) == -1 && container_elem.length == 1) {  // 输出内容为可见标签且输出目的scope唯一\n                if (config.outputAnimation)\n                    elem.fadeIn({\n                        complete: () => {\n                            // 当设置了AutoScrollBottom、并且当前输出输出到页面末尾时，滚动到底部\n                            if (state.AutoScrollBottom && output_to_root)\n                                this.scroll_bottom();\n                        }\n                    });\n                else if (state.AutoScrollBottom && output_to_root)\n                    this.scroll_bottom();\n\n            }\n        } else if (msg.command === 'output_ctl') {\n            this.handle_output_ctl(msg);\n        }\n    };\n\n    handle_output_ctl(msg: Command) {\n        if (msg.spec.set_scope !== undefined) {\n            let spec = msg.spec as {\n                set_scope: string, // scope名\n                container: string, // 此scope的父scope\n                position: number, // 在父scope中创建此scope的位置 0 -> 在父scope的顶部创建, -1 -> 在父scope的尾部创建\n                if_exist: string // 已经存在 ``name`` scope 时如何操作:  `'remove'` 表示先移除旧scope再创建新scope, `'clear'` 表示将旧scope的内容清除，不创建新scope，null/不指定时表示立即返回不进行任何操作\n            };\n\n            let container_elem = $(`${spec.container}`);\n            if (container_elem.length === 0)\n                return console.error(`Scope '${msg.spec.scope}' not found`);\n\n            let old = $(`#${spec.set_scope}`);\n            if (old.length) {\n                if (spec.if_exist == 'remove')\n                    old.remove();\n                else if (spec.if_exist == 'clear') {\n                    old.empty();\n                    return;\n                } else {\n                    return;\n                }\n            }\n\n            let html = `<div id=\"${spec.set_scope}\"></div>`;\n            if (spec.position === 0)\n                container_elem.prepend(html);\n            else if (spec.position === -1)\n                container_elem.append(html);\n            else {\n                if (spec.position >= 0)\n                    $(`${spec.container}>*`).eq(spec.position).insertBefore(html);\n                else\n                    $(`${spec.container}>*`).eq(spec.position).insertAfter(html);\n            }\n        }\n        if (msg.spec.clear !== undefined) {\n            $(msg.spec.clear).empty();\n        }\n        if (msg.spec.clear_before !== undefined)\n            $(`${msg.spec.clear_before}`).prevAll().remove();\n        if (msg.spec.clear_after !== undefined)\n            $(`${msg.spec.clear_after}~*`).remove();\n        if (msg.spec.scroll_to !== undefined) {\n            let target = $(`${msg.spec.scroll_to}`);\n            if (!target.length) {\n                console.error(`Scope ${msg.spec.scroll_to} not found`);\n            } else {\n                body_scroll_to(target, msg.spec.position);\n            }\n        }\n        if (msg.spec.clear_range !== undefined) {\n            if ($(`${msg.spec.clear_range[0]}`).length &&\n                $(`${msg.spec.clear_range[1]}`).length) {\n                let removed: HTMLElement[] = [];\n                let valid = false;\n                $(`${msg.spec.clear_range[0]}~*`).each(function () {\n                    if (this.id === msg.spec.clear_range[1]) {\n                        valid = true;\n                        return false;\n                    }\n                    removed.push(this);\n                    // $(this).remove();\n                });\n                if (valid)\n                    $(removed).remove();\n                else\n                    console.warn(`clear_range not valid: can't find ${msg.spec.clear_range[1]} after ${msg.spec.clear_range[0]}`);\n            }\n        }\n        if (msg.spec.remove !== undefined)\n            $(`${msg.spec.remove}`).remove();\n    };\n\n}\n","import {Command, Session} from \"../session\";\n\nimport {outputSpecToHtml} from \"../models/output\"\nimport {CommandHandler} from \"./base\";\n\n\nexport class PopupHandler implements CommandHandler {\n    session: Session;\n\n    accept_command = ['popup', 'close_popup'];\n\n    private body = $('body');\n\n    constructor(session: Session) {\n        this.session = session;\n    }\n\n    static current_elem: JQuery<HTMLElement> = null;  // 当前正在处于显示中的弹窗元素，表示页面的期望状态\n\n    handle_message(msg: Command) {\n        if (PopupHandler.current_elem) {\n            // @ts-ignore\n            PopupHandler.current_elem.modal('hide');\n            PopupHandler.current_elem = null;\n        }\n\n        if (msg.command == 'popup') {\n            // 显示弹窗前，先关闭其他弹窗\n            // @ts-ignore\n            $('.modal').modal('hide');\n\n            let elem = PopupHandler.get_element(msg.spec);\n            this.body.append(elem);\n\n            // 弹窗关闭后就立即销毁\n            elem.on('hidden.bs.modal', function (e) {\n                elem.remove();\n            });\n\n            elem.on('shown.bs.modal', function (e) {\n                // 弹窗显示后，有新弹窗出现或当前弹窗被关闭，则立即关闭当前弹窗\n                if (elem != PopupHandler.current_elem || !PopupHandler.current_elem) {\n                    // @ts-ignore\n                    elem.modal('hide');\n                }\n            });\n\n            // @ts-ignore\n            elem.modal('show');\n            PopupHandler.current_elem = elem;\n        } else if (msg.command == 'close_popup') {\n            // @ts-ignore\n            $('.modal').modal('hide');\n            PopupHandler.current_elem = null;\n        }\n    }\n\n    static get_element(spec: { title: string, content: any[], closable: boolean, implicit_close: boolean, size: string }) {\n        // https://v4.bootcss.com/docs/components/modal/#options\n        const tpl = `<div class=\"modal fade\" {{^implicit_close}}data-backdrop=\"static\"{{/implicit_close}} aria-labelledby=\"model-id-{{ dom_id }}\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n          <div class=\"modal-dialog modal-dialog-scrollable {{#large}}modal-lg{{/large}} {{#small}}modal-sm{{/small}}\" role=\"document\">\n            <div class=\"modal-content\">\n              <div class=\"modal-header\">\n                <h5 class=\"modal-title\" id=\"model-id-{{ mid }}\">{{ title }}</h5>\n                {{#closable}}\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                  <span aria-hidden=\"true\">&times;</span>\n                </button>\n                {{/closable}}\n              </div>\n              <div class=\"modal-body markdown-body\" id=\"{{ dom_id }}\">\n                {{#content}}\n                    {{& pywebio_output_parse}}\n                {{/content}}\n              </div>\n              <!--  \n              <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n                <button type=\"button\" class=\"btn btn-primary\">Submit</button>\n              </div> \n              -->\n            </div>\n          </div>\n        </div>`;\n\n        if (!spec.closable)\n            spec.implicit_close = false;\n\n        let pywebio_output_parse = function () {\n            if (this.type)\n                return outputSpecToHtml(this);\n            else\n                return outputSpecToHtml({type: 'text', content: this, inline: true});\n        };\n\n        let html = Mustache.render(tpl, {\n            ...spec,  // 字段： content, title, size, implicit_close, closable, dom_id\n            large: spec.size == 'large',\n            small: spec.size == 'small',\n            pywebio_output_parse: pywebio_output_parse\n        });\n        return $(html as string);\n    }\n\n}","import {Command, Session} from \"../session\";\nimport {CommandHandler} from \"./base\";\n\n\nexport class ScriptHandler implements CommandHandler {\n    session: Session;\n\n    accept_command = ['run_script'];\n\n    constructor(session: Session) {\n        this.session = session;\n    }\n\n    handle_message(msg: Command) {\n        let script = msg.spec.code as string;\n        let args = msg.spec.args as { [i: string]: any };\n        let arg_names:string[] = ['WebIOCurrentTaskID'], arg_vals:any[] = [msg.task_id];\n        for(let key in args){\n            arg_names.push(key);\n            arg_vals.push(args[key]);\n        }\n        const script_func = new Function(...arg_names, script);\n        script_func(...arg_vals);\n    }\n}","import {Command} from \"../session\";\nimport {CommandHandler} from \"./base\";\nimport {state} from \"../state\";\n\nexport class ToastHandler implements CommandHandler {\n    accept_command: string[] = ['toast'];\n\n    constructor() {\n    }\n\n    handle_message(msg: Command) {\n        let spec = msg.spec;\n        let toast = Toastify({\n            text: Mustache.escape(spec.content),\n            duration: spec.duration === 0 ? -1 : spec.duration,  // -1 for permanent toast\n            close: spec.duration === 0,//To show the close icon or not\n            gravity: \"top\", // `top` or `bottom`\n            position: spec.position, // `left`, `center` or `right`\n            backgroundColor: spec.color,\n            stopOnFocus: true, // Prevents dismissing of toast on hover\n            onClick: function () {\n                if (!spec.callback_id)\n                    return;\n\n                if (state.CurrentSession === null)\n                    return console.error(\"Error: WebIOController is not instantiated\");\n                state.CurrentSession.send_message({\n                    event: \"callback\",\n                    task_id: spec.callback_id,\n                    data: null\n                });\n                toast.hideToast();\n            }\n        });\n        toast.showToast();\n    }\n}","import {config as appConfig, state} from \"./state\";\nimport {ClientEvent, Command, HttpSession, is_http_backend, pushData, Session, WebSocketSession} from \"./session\";\nimport {InputHandler} from \"./handlers/input\"\nimport {OutputHandler} from \"./handlers/output\"\nimport {CloseHandler, CommandDispatcher} from \"./handlers/base\"\nimport {PopupHandler} from \"./handlers/popup\";\nimport {openApp} from \"./utils\";\nimport {ScriptHandler} from \"./handlers/script\";\nimport {DownloadHandler} from \"./handlers/download\";\nimport {ToastHandler} from \"./handlers/toast\";\nimport {EnvSettingHandler} from \"./handlers/env\";\n\n// 获取后端API地址\nfunction get_backend_addr() {\n    const url = new URLSearchParams(window.location.search);\n    let uri = url.get('pywebio_api') || './io';\n    return new URL(uri, window.location.href).href;\n}\n\n// 初始化Handler和Session\nfunction set_up_session(webio_session: Session, output_container_elem: JQuery, input_container_elem: JQuery) {\n    state.CurrentSession = webio_session;\n    webio_session.on_session_close(function () {\n        $('#favicon32').attr('href', 'data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAByElEQVRYR82XLUzDUBDH/9emYoouYHAYMGCAYJAYEhxiW2EOSOYwkKBQKBIwuIUPN2g7gSPBIDF8GWbA4DAjG2qitEfesi6lbGxlXd5q393/fr333t07QpdfPp8f0nV9CcACEU0DGAOgN9yrAN6Y+QnATbVavcrlcp/dSFMnI9M0J1RV3WHmFQCJTvaN9RoRXbiuu28YxstfPm0BbNtOMPMeEW0C0LoMHDZzmPmIiHbT6XStlUZLgEKhMK5p2iWAyX8GDruVHMdZzmazr+GFXwCmac4oinINYCSm4L5M2fO8RcMwHoO6PwAaf37bh+BNCMdx5oOZaAKIPQdwF2Pa2yWwBGDOPxNNAMuyDohoK+a0t5Rj5sNMJrMtFusA4qopivLcw2mPyu14njclrmgdoFgsnjLzWlSVXuyJ6CyVSq2TqHDJZPI9QpHpJW7Qt1apVEbJsqwVIjqPSzWKDjOvCoBjItqI4hiXLTOfkG3b9wBm4xKNqPMgAMoAhiM6xmX+IQC+AKhxKUbUcQcCQPoWyD2E0q+h9EIkvRRLb0YD0Y4FhNQHiQCQ/iQTEFIfpX4Nl/os9yGkDiY+hNTRLNhSpQ2n4b7er/H8G7N6BRSbHvW5AAAAAElFTkSuQmCC');\n        $('#favicon16').attr('href', 'data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA0ElEQVQ4T62TPQrCQBCF30tA8BZW9mJtY+MNEtKr2HkWK0Xtw+4NbGysxVorbyEKyZMNRiSgmJ/tZufNNzO7M0ThxHHc8zxvSnIIoPNyXyXt0zRdR1F0+gxhblhr25IWJMcA3vcFviRtSc6DILg5XyZ0wQB2AAbFir7YBwAjB8kAxpg1ycmfwZlM0iYMwyldz77vH3+U/Y2rJEn6NMYsSc7KZM+1kla01p4BdKsAAFwc4A6gVRHwaARQr4Xaj1j7G2sPUiOjnEMqL9PnDJRd5ycpJXsd2f2NIAAAAABJRU5ErkJggg==');\n    });\n\n    let output_ctrl = new OutputHandler(webio_session, output_container_elem);\n    let input_ctrl = new InputHandler(webio_session, input_container_elem);\n    let popup_ctrl = new PopupHandler(webio_session);\n    let close_ctrl = new CloseHandler(webio_session);\n    let script_ctrl = new ScriptHandler(webio_session);\n    let download_ctrl = new DownloadHandler();\n    let toast_ctrl = new ToastHandler();\n    let env_ctrl = new EnvSettingHandler();\n\n    let dispatcher = new CommandDispatcher(output_ctrl, input_ctrl, popup_ctrl, close_ctrl, script_ctrl, download_ctrl, toast_ctrl, env_ctrl);\n\n    webio_session.on_server_message((msg: Command) => {\n        try {\n            let ok = dispatcher.dispatch_message(msg);\n            if (!ok) console.error('Unknown command:%s', msg.command);\n        } catch (e) {\n            console.error('Error(%s) in dispatch command: %s', e, msg.command);\n        }\n    });\n}\n\nfunction startWebIOClient(output_container_elem: JQuery, input_container_elem: JQuery, app_name: string, config: { [name: string]: any }) {\n    for (let key in config) {\n        // @ts-ignore\n        appConfig[key] = config[key];\n    }\n    const backend_addr = get_backend_addr();\n    is_http_backend(backend_addr).then(function (http_backend) {\n        let session;\n        if (http_backend)\n            session = new HttpSession(backend_addr, app_name, appConfig.httpPullInterval);\n        else\n            session = new WebSocketSession(backend_addr, app_name);\n        set_up_session(session, output_container_elem, input_container_elem);\n        session.start_session(appConfig.debug);\n    });\n\n}\n\n// @ts-ignore\nwindow.WebIO = {\n    'startWebIOClient': startWebIOClient,\n    'sendMessage': (msg: ClientEvent) => {\n        return state.CurrentSession.send_message(msg);\n    },\n    'openApp': openApp,\n    'pushData': pushData,\n};","import {Session} from \"../../session\";\nimport {InputItem} from \"./base\";\n\nconst buttons_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label>{{label}}</label>  <br> {{/label}} \n    {{#buttons}}\n    <button type=\"{{btn_type}}\" data-type=\"{{type}}\" aria-describedby=\"{{name}}_help\" {{#disabled}}disabled data-pywebio-disabled{{/disabled}} class=\"btn btn-primary\">{{label}}</button>\n    {{/buttons}}\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n    <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    <small id=\"{{name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\nexport class Actions extends InputItem {\n    static accept_input_types: string[] = [\"actions\"];\n\n    submit_value: string = null; // 提交表单时按钮组的value\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        for (let b of this.spec.buttons) b['btn_type'] = b.type === \"submit\" ? \"submit\" : \"button\";\n\n        const html = Mustache.render(buttons_tpl, this.spec);\n        this.element = $(html);\n        let btns = this.element.find('button');\n        for(let idx =0; idx<this.spec.buttons.length; idx++)\n            btns.eq(idx).val(JSON.stringify(this.spec.buttons[idx].value));\n\n        let that = this;\n        this.element.find('button').on('click', function (e) {\n            let btn = $(this);\n            if (btn.data('type') === 'submit') {\n                that.submit_value = JSON.parse(btn.val() as string);\n                // 不可以使用 btn.parents('form').submit()， 会导致input 的required属性失效\n            } else if (btn.data('type') === 'reset') {\n                btn.parents('form').trigger(\"reset\");\n            } else if (btn.data('type') === 'cancel') {\n                that.session.send_message({\n                    event: \"from_cancel\",\n                    task_id: that.task_id,\n                    data: null\n                });\n            } else {\n                console.error(\"`actions` input: unknown button type '%s'\", btn.data('type'));\n            }\n        });\n\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n        let idx = -1;\n        if ('target_value' in spec) {\n            this.element.find('button').each(function (index) {\n                if (JSON.parse($(this).val() as string) === spec.target_value) {\n                    idx = index;\n                    return false;\n                }\n            });\n        }\n        this.update_input_helper(idx, attributes);\n    }\n\n    get_value(): any {\n        return this.submit_value;\n    }\n}\n\n\n\n","import {Session} from \"../../session\";\n\nexport class InputItem {\n    static accept_input_types: string[] = [];\n\n    session: Session;\n    task_id: string;\n    spec: any;\n\n    element: JQuery = null; // 在 create_element() 时赋值\n\n    constructor(session: Session, task_id: string, spec: any) {\n        this.session = session;\n        this.task_id = task_id;\n        this.spec = spec;\n    }\n\n    create_element(): JQuery {\n        throw new Error(\"Not implement!\");\n    }\n\n    update_input(spec: any): any {\n        throw new Error(\"Not implement!\");\n    }\n\n    get_value(): any {\n        throw new Error(\"Not implement!\");\n    }\n\n    // 检查输入项的有效性，在表单提交时调用\n    check_valid():boolean{\n        return true;\n    }\n\n    //在表单加入DOM树后触发\n    after_add_to_dom(): any {\n\n    }\n\n    //在表单被显示后触发\n    after_show(first_show:boolean): any {\n\n    }\n\n    protected send_value_listener(input_item: this, event: { type: string }) {\n        // let this_elem = $(this);\n        input_item.session.send_message({\n            event: \"input_event\",\n            task_id: input_item.task_id,\n            data: {\n                event_name: event.type.toLowerCase(),\n                name: input_item.spec.name,\n                value: input_item.get_value()\n            }\n        });\n    };\n\n    /*\n    * input_idx: 更新作用对象input标签的索引, -1 为不指定对象\n    * attributes：更新值字典\n    * */\n    protected update_input_helper(input_idx: number, attributes: { [i: string]: any }) {\n        let attr2selector: { [i: string]: string } = {\n            'invalid_feedback': 'div.invalid-feedback',\n            'valid_feedback': 'div.valid-feedback',\n            'help_text': 'small.text-muted'\n        };\n        for (let attribute in attr2selector) {\n            if (attribute in attributes) {\n                if (input_idx === -1)\n                    this.element.find(attr2selector[attribute]).text(attributes[attribute]);\n                else\n                    this.element.find(attr2selector[attribute]).eq(input_idx).text(attributes[attribute]);\n                delete attributes[attribute];\n            }\n        }\n        let input_elem = this.element.find('input,select,textarea');\n        if (input_idx >= 0)\n            input_elem = input_elem.eq(input_idx);\n\n        if ('valid_status' in attributes) {\n            let class_name = attributes.valid_status ? 'is-valid' : 'is-invalid';\n            if(attributes.valid_status===0) class_name = '';  // valid_status为0时，表示清空valid_status标志\n            input_elem.removeClass('is-valid is-invalid').addClass(class_name);\n            delete attributes.valid_status;\n        }\n        input_elem.prop(attributes);\n    }\n}\n\n\n\n","import {Session} from \"../../session\";\nimport {InputItem} from \"./base\";\nimport {deep_copy} from \"../../utils\"\n\nconst checkbox_radio_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label>{{label}}</label>{{/label}}\n    {{#inline}}<br>{{/inline}}\n    {{#options}}\n    <div class=\"form-check {{#inline}}form-check-inline{{/inline}}\">\n        <input type=\"{{type}}\" id=\"{{id_name_prefix}}-{{idx}}\" name=\"{{name}}\" {{#selected}}checked{{/selected}} {{#disabled}}disabled{{/disabled}} class=\"form-check-input\">\n        <label class=\"form-check-label\" for=\"{{id_name_prefix}}-{{idx}}\">\n            {{label}}\n        </label>\n        <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n        <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    </div>\n    {{/options}}\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\nexport class CheckboxRadio extends InputItem {\n    static accept_input_types: string[] = [\"checkbox\", \"radio\"];\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name_prefix = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name_prefix'] = id_name_prefix;\n        for (let idx in spec.options) {\n            spec.options[idx]['idx'] = idx;\n        }\n        const html = Mustache.render(checkbox_radio_tpl, spec);\n        let elem = $(html);\n        this.element = elem;\n\n        let inputs = elem.find('input');\n        for (let idx = 0; idx < spec.options.length; idx++)\n            inputs.eq(idx).val(JSON.stringify(spec.options[idx].value));\n\n        const ignore_keys = {'value': '', 'label': '', 'selected': ''};\n        for (let idx = 0; idx < this.spec.options.length; idx++) {\n            let input_elem = elem.find('#' + id_name_prefix + '-' + idx);\n            // blur事件时，发送当前值到服务器\n            // checkbox_radio 不产生blur事件\n            // input_elem.on('blur', this.send_value_listener);\n\n            // 将额外的html参数加到input标签上\n            for (let key in this.spec.options[idx]) {\n                if (key in ignore_keys) continue;\n                input_elem.attr(key, this.spec.options[idx][key]);\n            }\n        }\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n        let idx = -1;\n        if ('target_value' in spec) {\n            this.element.find('input').each(function (index) {\n                if (JSON.parse($(this).val() as string) === spec.target_value) {\n                    idx = index;\n                    return false;\n                }\n            });\n        }\n        this.update_input_helper(idx, attributes);\n    }\n\n    get_value(): any {\n        if (this.spec.type === 'radio') {\n            let raw_val = this.element.find('input:checked').val() || 'null';\n            return JSON.parse(raw_val as string);\n        } else {\n            let value_arr = this.element.find('input').serializeArray();\n            let res: any[] = [];\n            let that = this;\n            $.each(value_arr, function (idx, val) {\n                if (val.name === that.spec.name)\n                    res.push(JSON.parse(val.value as string));\n                console.log(JSON.parse(val.value as string), typeof JSON.parse(val.value as string));\n            });\n            return res;\n        }\n    }\n}\n\n\n\n","import {Session} from \"../../session\";\nimport {InputItem} from \"./base\";\nimport {deep_copy} from \"../../utils\"\n\nconst file_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <div class=\"custom-file\">\n        <input type=\"file\" name=\"{{name}}\" class=\"custom-file-input\" id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\">\n        <label class=\"custom-file-label\" for=\"{{id_name}}\">{{placeholder}}</label>\n        <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n        <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n        <small id=\"{{id_name}}_help\"  class=\"form-text text-muted\">{{help_text}}</small>\n    </div>\n</div>`;\n\nexport class File extends InputItem {\n    static accept_input_types: string[] = [\"file\"];\n\n    data_url_value: { filename: string, dataurl: string, mime_type: string, last_modified: number, size: number }[] = []; // 待上传文件信息\n    valid = true;\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n\n        const html = Mustache.render(file_input_tpl, spec);\n        this.element = $(html);\n        let input_elem = this.element.find('input[type=\"file\"]');\n\n        const ignore_keys = {\n            'label': '',\n            'invalid_feedback': '',\n            'valid_feedback': '',\n            'help_text': '',\n            'placeholder': ''\n        };\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n\n        // 文件选中后先不通知后端\n        let that = this;\n        input_elem.on('change', function () {\n            that.data_url_value = [];\n            let total_size = 0;\n            that.valid = true;\n            let file = (input_elem[0] as HTMLInputElement).files;\n            for (let f of file) {\n                let fr = new FileReader();\n                total_size += f.size;\n\n                if (that.spec.max_size && f.size > that.spec.max_size) {\n                    that.valid = false;\n                    that.update_input_helper(-1, {\n                        'valid_status': false,\n                        'invalid_feedback': `文件\"${f.name}\"大小超过限制: 单个文件大小不超过${that._formate_size(that.spec.max_size)}`\n                    });\n                } else if (that.spec.max_total_size && total_size > that.spec.max_total_size) {\n                    that.valid = false;\n                    that.update_input_helper(-1, {\n                        'valid_status': false,\n                        'invalid_feedback': `文件总大小超过限制: 文件总大小不超过${that._formate_size(that.spec.max_total_size)}`\n                    });\n                    return;\n                }\n                if (!that.valid) return;\n                that.update_input_helper(-1, {'valid_status': 0});\n\n                fr.onload = function () {\n                    that.data_url_value.push({\n                        'filename': f.name,\n                        'size': f.size,\n                        'mime_type': f.type,\n                        'last_modified': f.lastModified / 1000,\n                        'dataurl': fr.result as string\n                    });\n                };\n                fr.readAsDataURL(f);\n            }\n\n        });\n\n        return this.element;\n    }\n\n    _formate_size(size: number): string {\n        for (let s of ['Byte', 'Kb', 'Mb']) {\n            if (size / 1024 < 1)\n                return size.toFixed(2) + s;\n            size = size / 1024;\n        }\n        return size.toFixed(2) + 'Gb';\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n        this.update_input_helper(-1, attributes);\n    }\n\n    check_valid(): boolean {\n        return this.valid;\n    }\n\n    get_value(): any {\n        return this.data_url_value;\n    }\n\n    after_add_to_dom(): any {\n        bsCustomFileInput.init();\n    }\n}\n\n\n\n","import {Input} from \"./input\"\nimport {Actions} from \"./actions\"\nimport {CheckboxRadio} from \"./checkbox_radio\"\nimport {Textarea} from \"./textarea\"\nimport {File} from \"./file\"\nimport {Select} from \"./select\"\n\n\nexport const all_input_items = [Input, Actions, CheckboxRadio, Textarea, File, Select];","import {InputItem} from \"./base\";\nimport {Session} from \"../../session\";\nimport {deep_copy} from \"../../utils\"\nimport {state} from \"../../state\";\n\n\nconst common_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <div class=\"input-group\">\n        <input type=\"{{type}}\" id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_action_btn\"  {{#list}}list=\"{{list}}\"{{/list}} class=\"form-control\" >\n        <datalist id=\"{{id_name}}-list\">\n            {{#datalist}} \n            <option>{{.}}</option> \n            {{/datalist}}\n        </datalist>\n        {{#action}} \n        <div class=\"input-group-append\">\n            <button class=\"btn btn-outline-secondary single-input-action-btn\" type=\"button\" id=\"{{id_name}}_action_btn\" data-callbackid=\"{{callback_id}}\">{{label}}</button>\n        </div>\n        {{/action}} \n        <div class=\"invalid-feedback\">{{invalid_feedback}}</div>\n        <div class=\"valid-feedback\">{{valid_feedback}}</div>\n    </div>\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\n\nexport class Input extends InputItem {\n    static accept_input_types: string[] = [\"text\", \"password\", \"number\", \"color\", \"date\", \"range\", \"time\", \"email\", \"url\"];\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n        if (spec.datalist)\n            spec['list'] = id_name + '-list';\n\n        let html = Mustache.render(common_input_tpl, spec);\n\n        this.element = $(html);\n\n        this.element.find(`#${id_name}_action_btn`).on('click', function (e) {\n            let btn = $(this);\n            state.CurrentSession.send_message({\n                event: \"callback\",\n                task_id: btn.data('callbackid') as string,\n                data: null\n            });\n        });\n\n        let input_elem = this.element.find('#' + id_name);\n        // blur事件时，发送当前值到服务器\n        input_elem.on(\"blur\", (e) => {\n            this.send_value_listener(this, e)\n        });\n\n        // 将额外的html参数加到input标签上\n        const ignore_keys = {\n            'action': '',\n            'type': '',\n            'label': '',\n            'invalid_feedback': '',\n            'valid_feedback': '',\n            'help_text': '',\n            'options': '',\n            'datalist': '',\n            'multiple': ''\n        };\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n\n        this.update_input_helper(-1, attributes);\n    }\n\n    get_value(): any {\n        return this.element.find('input').val();\n    }\n}\n\n","import {InputItem} from \"./base\";\nimport {Session} from \"../../session\";\nimport {deep_copy} from \"../../utils\"\n\n\nconst select_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <select id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\" class=\"form-control\" {{#multiple}}multiple{{/multiple}}>\n        {{#options}}\n        <option {{#selected}}selected{{/selected}} {{#disabled}}disabled{{/disabled}}>{{label}}</option>\n        {{/options}}\n    </select>\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>\n    <div class=\"valid-feedback\">{{valid_feedback}}</div>\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\nexport class Select extends InputItem {\n    static accept_input_types: string[] = [\"select\"];\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n\n        let html = Mustache.render(select_input_tpl, spec);\n\n        this.element = $(html);\n        let input_elem = this.element.find('#' + id_name);\n\n        let opts = input_elem.find('option');\n        for (let idx = 0; idx < spec.options.length; idx++)\n            opts.eq(idx).val(JSON.stringify(spec.options[idx].value));\n\n        // blur事件时，发送当前值到服务器\n        input_elem.on(\"blur\", (e) => {\n            this.send_value_listener(this, e)\n        });\n\n        // 将额外的html参数加到input标签上\n        const ignore_keys = {\n            'type': '',\n            'label': '',\n            'invalid_feedback': '',\n            'valid_feedback': '',\n            'help_text': '',\n            'options': '',\n            'datalist': '',\n            'multiple': ''\n        };\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n\n        this.update_input_helper(-1, attributes);\n    }\n\n    get_value(): any {\n        let raw_val = this.element.find('select').val();\n        if (this.spec.multiple) {\n            let res: any[] = [];\n            for (let i of (raw_val as string[]))\n                res.push(JSON.parse(i));\n            return res;\n        } else {\n            return JSON.parse(raw_val as string);\n        }\n    }\n}\n\n","import {InputItem} from \"./base\";\nimport {Session} from \"../../session\";\nimport {deep_copy, make_set} from \"../../utils\"\nimport {config as appConfig} from \"../../state\";\n\n\nconst textarea_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <textarea id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\" rows=\"{{rows}}\" class=\"form-control\" >{{value}}</textarea>\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n    <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\n\nexport class Textarea extends InputItem {\n    static accept_input_types: string[] = [\"textarea\"];\n\n    private code_mirror: any = null;\n    private code_mirror_config: { [name: string]: any } = {\n        'theme': 'base16-light',\n        'mode': 'python',\n        'lineNumbers': true,  // 显示行数\n        'indentUnit': 4,  //缩进单位为4\n        'styleActiveLine': true,  // 当前行背景高亮\n        'matchBrackets': true,  //括号匹配\n        'lineWrapping': true,  //自动换行\n    };\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element() {\n        let that = this;\n\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n        let html = Mustache.render(textarea_input_tpl, spec);\n        this.element = $(html);\n        let input_elem = this.element.find('#' + id_name);\n\n        // blur事件时，发送当前值到服务器\n        // input_elem.on('blur', this.send_value_listener);\n\n        // 将额外的html参数加到input标签上\n        const ignore_keys = make_set(['value', 'type', 'label', 'invalid_feedback', 'valid_feedback', 'help_text', 'rows', 'code']);\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n        if (spec.code) {\n            CodeMirror.modeURL = appConfig.codeMirrorModeURL;\n\n            for (let k in that.spec.code)\n                this.code_mirror_config[k] = that.spec.code[k];\n\n            if (that.spec.readonly || that.spec.disabled)\n                this.code_mirror_config['readOnly'] = \"nocursor\";\n\n            if (this.code_mirror_config.theme && this.code_mirror_config.theme !== 'base16-light')\n                Textarea.load_codemirror_theme(this.code_mirror_config.theme);\n        }\n\n        return this.element;\n    };\n\n    update_input(spec: any) {\n        let attributes = spec.attributes;\n\n        this.update_input_helper.call(this, -1, attributes);\n    };\n\n    get_value() {\n        return this.element.find('textarea').val();\n    };\n\n    after_show(first_show: boolean): any {\n        if (first_show && this.spec.code) {\n            this.code_mirror = CodeMirror.fromTextArea(this.element.find('textarea')[0], this.code_mirror_config);\n            CodeMirror.autoLoadMode(this.code_mirror, this.code_mirror_config.mode);\n            this.code_mirror.setSize(null, 20 * this.spec.rows);\n        }\n    };\n\n    static load_codemirror_theme(theme: string, url_tpl = appConfig.codeMirrorThemeURL) {\n        let cssId = 'codemirror_theme_' + theme;  // you could encode the css path itself to generate id..\n        if (!document.getElementById(cssId)) {\n            let head = document.getElementsByTagName('head')[0];\n            let link = document.createElement('link');\n            link.id = cssId;\n            link.rel = 'stylesheet';\n            link.type = 'text/css';\n            link.href = url_tpl.replace('%N', theme);\n            link.media = 'all';\n            head.appendChild(link);\n        }\n    }\n}\n\n\n\n","import {b64toBlob} from \"../utils\";\n\n/*\n* 当前限制\n* 若Widget被作为其他Widget的子项时，该Widget中绑定的事件将会失效\n* */\n\nexport interface Widget {\n    handle_type: string;\n\n    get_element(spec: any): JQuery;\n}\n\nlet Text = {\n    handle_type: 'text',\n    get_element: function (spec: any): JQuery {\n        let elem = spec.inline ? $('<span></span>') : $('<p></p>');\n        spec.content = spec.content.replace(/ /g, '\\u00A0');\n        // make '\\n' to <br/>\n        let lines = (spec.content || '').split('\\n');\n        for (let idx = 0; idx < lines.length - 1; idx++)\n            elem.append(document.createTextNode(lines[idx])).append('<br/>');\n        elem.append(document.createTextNode(lines[lines.length - 1]));\n        return elem;\n    }\n};\n\nlet _md_parser = new Mditor.Parser();\nlet Markdown = {\n    handle_type: 'markdown',\n    get_element: function (spec: any) {\n        return $(_md_parser.parse(spec.content));\n    }\n};\n\n// 将html字符串解析成jQuery对象\nfunction parseHtml(html_str: string) {\n    let nodes = $.parseHTML(html_str, null, true);\n    let elem;\n    if (nodes.length != 1)\n        elem = $(document.createElement('div')).append(nodes);\n    else\n        elem = $(nodes[0]);\n    return elem;\n}\n\nlet Html = {\n    handle_type: 'html',\n    get_element: function (spec: any) {\n        return parseHtml(spec.content);\n    }\n};\n\nlet Buttons = {\n    handle_type: 'buttons',\n    get_element: function (spec: any) {\n        const btns_tpl = `<div>{{#buttons}} \n                                <button class=\"btn {{#color}}btn-{{color}}{{/color}}{{#small}} btn-sm{{/small}}\">{{label}}</button> \n                          {{/buttons}}</div>`;\n        spec.color = spec.link ? \"link\" : \"primary\";\n        let html = Mustache.render(btns_tpl, spec);\n        let elem = $(html);\n\n        let btns = elem.find('button');\n        for (let idx = 0; idx < spec.buttons.length; idx++) {\n            // note： 若Buttons被作为其他Widget的子项时，Buttons中绑定的事件将会失效，所以使用onclick attr设置点击事件\n            btns.eq(idx).attr('onclick', `WebIO.pushData(${JSON.stringify(spec.buttons[idx].value)}, \"${spec.callback_id}\")`);\n        }\n\n        return elem;\n    }\n};\n\n// 已废弃。为了向下兼容而保留\nlet File = {\n    handle_type: 'file',\n    get_element: function (spec: any) {\n        const html = `<div><button type=\"button\" class=\"btn btn-link\">${spec.name}</button></div>`;\n        let element = $(html);\n        let blob = b64toBlob(spec.content);\n        element.on('click', 'button', function (e) {\n            saveAs(blob, spec.name, {}, false);\n        });\n\n        return element;\n    }\n};\n\n\nlet Table = {\n    handle_type: 'table',\n    get_element: function (spec: { data: any[][], span: { [i: string]: { col: number, row: number } } }) {\n        const table_tpl = `\n<table>\n    <tr>\n        {{#header}} \n        <th{{#col}} colspan=\"{{col}}\"{{/col}}{{#row}} rowspan=\"{{row}}\"{{/row}}>{{& data}}</th> \n        {{/header}}\n    </tr>\n      {{#tdata}} \n      <tr>\n        {{# . }} \n        <td{{#col}} colspan=\"{{col}}\"{{/col}}{{#row}} rowspan=\"{{row}}\"{{/row}}>{{& data}}</td> \n        {{/ . }} \n      </tr>\n      {{/tdata}}\n    \n</table>`;\n\n        interface itemType {\n            data: string,\n            col?: number,\n            row?: number\n        }\n\n        // 将spec转化成模版引擎的输入\n        let table_data: itemType[][] = [];\n        for (let row_id in spec.data) {\n            table_data.push([]);\n            let row = spec.data[row_id];\n            for (let col_id in row) {\n                let data = spec.data[row_id][col_id];\n\n                // 处理简单类型单元格，即单元格不是output命令的spec\n                if (typeof data !== 'object') {\n                    data = {type: 'text', content: data, inline: true};\n                }\n\n                table_data[row_id].push({\n                    data: outputSpecToHtml(data),\n                    ...(spec.span[row_id + ',' + col_id] || {})\n                });\n            }\n        }\n\n        let header: itemType[], data: itemType[][];\n        [header, ...data] = table_data;\n        let html = Mustache.render(table_tpl, {header: header, tdata: data});\n        return $(html);\n    }\n};\n\nlet CustomWidget = {\n    handle_type: 'custom_widget',\n    get_element: function (spec: { template: string, data: { [i: string]: any } }) {\n        spec.data['pywebio_output_parse'] = function () {\n            if (this.type)\n                return outputSpecToHtml(this);\n            else\n                return outputSpecToHtml({type: 'text', content: this, inline: true});\n        };\n        let html = Mustache.render(spec.template, spec.data);\n        return parseHtml(html);\n    }\n};\n\nlet all_widgets: Widget[] = [Text, Markdown, Html, Buttons, File, Table, CustomWidget];\n\n\nlet type2widget: { [i: string]: Widget } = {};\nfor (let w of all_widgets)\n    type2widget[w.handle_type] = w;\n\nexport function getWidgetElement(spec: any) {\n    if (!(spec.type in type2widget))\n        throw Error(\"Unknown type in getWidgetElement() :\" + spec.type);\n\n    let elem = type2widget[spec.type].get_element(spec);\n    if (spec.style) {\n        let old_style = elem.attr('style') || '';\n        elem.attr({\"style\": old_style + spec.style});\n    }\n    return elem;\n}\n\n// 将output指令的spec字段解析成html字符串\nexport function outputSpecToHtml(spec: any) {\n    let html = '';\n    try {\n        let nodes = getWidgetElement(spec);\n        for (let node of nodes)\n            html += node.outerHTML || '';\n    } catch (e) {\n        console.error('Get sub widget html error,', e, spec);\n    }\n    return html;\n}\n\n\n","import {error_alert} from \"./utils\";\nimport {state} from \"./state\";\n\nexport interface Command {\n    command: string\n    task_id: string\n    spec: any\n}\n\nexport interface ClientEvent {\n    event: string,\n    task_id: string,\n    data: any\n}\n\n\n/*\n* 会话\n* 向外暴露的事件：on_session_create、on_session_close、on_server_message\n* 提供的函数：start_session、send_message、close_session\n* */\nexport interface Session {\n    on_session_create(callback: () => void): void;\n\n    on_session_close(callback: () => void): void;\n\n    on_server_message(callback: (msg: Command) => void): void;\n\n    start_session(debug: boolean): void;\n\n    send_message(msg: ClientEvent, onprogress?: (loaded: number, total: number) => void): void;\n\n    close_session(): void;\n\n    closed(): boolean;\n}\n\nexport class WebSocketSession implements Session {\n    ws: WebSocket;\n    debug: boolean;\n    private _closed: boolean;\n    private _on_session_create: (this: WebSocket, ev: Event) => any = () => {\n    };\n    private _on_session_close: (this: WebSocket, ev: CloseEvent) => any = () => {\n    };\n    private _on_server_message: (msg: Command) => any = () => {\n    };\n\n    constructor(public ws_api: string, app_name: string = 'index') {\n        this.ws = null;\n        this.debug = false;\n        this._closed = false;\n\n        let url = new URL(ws_api);\n        if (url.protocol !== 'wss:' && url.protocol !== 'ws:') {\n            let protocol = url.protocol || window.location.protocol;\n            url.protocol = protocol.replace('https', 'wss').replace('http', 'ws');\n        }\n        url.search = \"?app=\" + app_name;\n        this.ws_api = url.href;\n    }\n\n    on_session_create(callback: () => any): void {\n        this._on_session_create = callback;\n    };\n\n    on_session_close(callback: () => any): void {\n        this._on_session_close = callback;\n    }\n\n    on_server_message(callback: (msg: Command) => any): void {\n        this._on_server_message = callback;\n    }\n\n    start_session(debug: boolean = false): void {\n        this.debug = debug;\n        this.ws = new WebSocket(this.ws_api);\n        this.ws.onopen = this._on_session_create;\n        this.ws.onclose = this._on_session_close;\n        let that = this;\n        this.ws.onmessage = function (evt) {\n            let msg: Command = JSON.parse(evt.data);\n            if (debug) console.info('>>>', JSON.parse(evt.data));\n            that._on_server_message(msg);\n        };\n    }\n\n    start_onprogress(onprogress?: (loaded: number, total: number) => void): void {\n        let total = this.ws.bufferedAmount;\n        let onprogressID = setInterval(() => {\n            let loaded = total - this.ws.bufferedAmount;\n            onprogress(loaded, total);\n            if (this.ws.bufferedAmount == 0)\n                clearInterval(onprogressID);\n        }, 200);\n    }\n\n    send_message(msg: ClientEvent, onprogress?: (loaded: number, total: number) => void): void {\n        if (this.closed())\n            return error_alert(\"与服务器连接已断开，请刷新页面重新操作\");\n\n        if (this.ws === null)\n            return console.error('WebSocketWebIOSession.ws is null when invoke WebSocketWebIOSession.send_message. ' +\n                'Please call WebSocketWebIOSession.start_session first');\n        this.ws.send(JSON.stringify(msg));\n\n        if (onprogress)\n            this.start_onprogress(onprogress);\n\n        if (this.debug) console.info('<<<', msg);\n    }\n\n    close_session(): void {\n        this._closed = true;\n        this._on_session_close.call(this.ws, null);\n        try {\n            this.ws.close()\n        } catch (e) {\n        }\n    }\n\n    closed(): boolean {\n        return this._closed || this.ws.readyState === WebSocket.CLOSED || this.ws.readyState === WebSocket.CLOSING;\n    }\n}\n\n\nexport class HttpSession implements Session {\n    interval_pull_id: number = null;\n    webio_session_id: string;\n    debug = false;\n\n    private _closed = false;\n    private _on_session_create: () => void = () => {\n    };\n    private _on_session_close: () => void = () => {\n    };\n    private _on_server_message: (msg: Command) => void = () => {\n    };\n\n\n    constructor(public api_url: string, app_name = 'index', public pull_interval_ms = 1000) {\n        let url = new URL(api_url, window.location.href);\n        url.search = \"?app=\" + app_name;\n        this.api_url = url.href;\n    }\n\n    on_session_create(callback: () => void): void {\n        this._on_session_create = callback;\n    }\n\n    on_session_close(callback: () => void): void {\n        this._on_session_close = callback;\n    }\n\n    on_server_message(callback: (msg: Command) => void): void {\n        this._on_server_message = callback;\n    }\n\n    start_session(debug: boolean = false): void {\n        this.debug = debug;\n        this.pull();\n        this.interval_pull_id = setInterval(()=>{this.pull()},this.pull_interval_ms);\n    }\n\n    pull() {\n        let that = this;\n        $.ajax({\n            type: \"GET\",\n            url: this.api_url,\n            contentType: \"application/json; charset=utf-8\",\n            dataType: \"json\",\n            headers: {\"webio-session-id\": this.webio_session_id},\n            success: function (data: Command[], textStatus: string, jqXHR: JQuery.jqXHR) {\n                that._on_request_success(data, textStatus, jqXHR);\n                that._on_session_create();\n            },\n            error: function () {\n                console.error('Http pulling failed');\n            }\n        })\n    }\n\n    private _on_request_success(data: Command[], textStatus: string, jqXHR: JQuery.jqXHR) {\n        let sid = jqXHR.getResponseHeader('webio-session-id');\n        if (sid) this.webio_session_id = sid;\n\n        for (let msg of data) {\n            if (this.debug) console.info('>>>', msg);\n            this._on_server_message(msg);\n        }\n    };\n\n    send_message(msg: ClientEvent, onprogress?: (loaded: number, total: number) => void): void {\n        if (this.closed())\n            return error_alert(\"与服务器连接已断开，请刷新页面重新操作\");\n\n        if (this.debug) console.info('<<<', msg);\n        $.ajax({\n            type: \"POST\",\n            url: this.api_url,\n            data: JSON.stringify(msg),\n            contentType: \"application/json; charset=utf-8\",\n            dataType: \"json\",\n            headers: {\"webio-session-id\": this.webio_session_id},\n            success: this._on_request_success.bind(this),\n            xhr: function () {\n                let xhr = new window.XMLHttpRequest();\n                // Upload progress\n                xhr.upload.addEventListener(\"progress\", function (evt) {\n                    if (evt.lengthComputable && onprogress) {\n                        onprogress(evt.loaded, evt.total);\n                    }\n                }, false);\n                return xhr;\n            },\n            error: function () {  // todo\n                console.error('Http push event failed, event data: %s', msg);\n                error_alert(\"连接服务器失败!\");\n            }\n        });\n\n    }\n\n    close_session(): void {\n        this._closed = true;\n        this._on_session_close();\n        clearInterval(this.interval_pull_id);\n    }\n\n    closed(): boolean {\n        return this._closed;\n    }\n\n    change_pull_interval(new_interval: number): void {\n        clearInterval(this.interval_pull_id);\n        this.pull_interval_ms = new_interval;\n        this.interval_pull_id = setInterval(()=>{this.pull()}, this.pull_interval_ms);\n    }\n}\n\n/*\n* Check given `backend_addr` is a http backend\n* Usage:\n*   // `http_backend` is a boolean to present whether or not a http_backend the given `backend_addr` is\n*   is_http_backend('http://localhost:8080/io').then(function(http_backend){ });\n* */\nexport function is_http_backend(backend_addr: string) {\n    let url = new URL(backend_addr);\n    let protocol = url.protocol || window.location.protocol;\n    url.protocol = protocol.replace('wss', 'https').replace('ws', 'http');\n    backend_addr = url.href;\n\n    return new Promise(function (resolve, reject) {\n        $.get(backend_addr, {test: 1}, undefined, 'html').done(function (data: string) {\n            resolve(data === 'ok');\n        }).fail(function (e: JQuery.jqXHR) {\n            resolve(false);\n        });\n    });\n}\n\n\n// 向服务端发送数据\nexport function pushData(data: any, callback_id: string) {\n    if (state.CurrentSession === null)\n        return console.error(\"can't invoke PushData when WebIOController is not instantiated\");\n\n    state.CurrentSession.send_message({\n        event: \"callback\",\n        task_id: callback_id,\n        data: data\n    });\n}","import {Session} from \"./session\";\n\n// 运行时状态\nexport let state = {\n    AutoScrollBottom: false,  // 是否有新内容时自动滚动到底部\n    CurrentSession: null as Session,  // 当前正在活跃的会话\n    ShowDuration: 200,  // ms, 显示表单的过渡动画时长\n};\n\n// 应用配置\nexport let config = {\n    codeMirrorModeURL: \"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/%N/%N.min.js\",\n    codeMirrorThemeURL: \"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/theme/%N.min.css\",\n    outputAnimation: true, // 启用内容输出动画\n    httpPullInterval: 1000,  // HttpSession 拉取消息的周期（ms）\n    debug: false,  // 调试模式， 打印所有交互的消息\n};\n","let has_input = false;\nlet input_panel = $('#input-container');\nlet input_cards = $('#input-cards');\nlet end_space = $('#end-space');\n\nexport function show_input() {\n    close_input();\n    has_input = true;\n    if (($(window).height() - input_panel[0].getBoundingClientRect().top < input_min_fixed_height() - 40)) {\n        toggle_input_panel_style(true);\n    }\n}\n\nexport function close_input() {\n    has_input = false;\n    if (input_panel.hasClass('fixed')) {\n        input_panel.removeClass('fixed');\n    }\n    input_panel.height('unset');\n    end_space.height(0);\n}\n\n\nfunction input_min_fixed_height() { // 返回当前的输入panel的最小高度\n    const min_fixed_height = 300;\n\n    //80 = #input-container.fixed padding-top + padding-bottom\n    let now_height = input_cards.height() + 80;\n\n    return now_height > min_fixed_height ? min_fixed_height : now_height;\n}\n\n\nfunction toggle_input_panel_style(fixed: boolean) {\n    if (!fixed) {\n        input_panel.removeClass('fixed');\n        end_space.height(0);\n        input_panel.height('unset');\n    } else {\n        let min = input_min_fixed_height();\n        end_space.height(min - 40);  // 40 =  #input-container.fixed padding-top\n        input_panel.height(min);\n        // input_panel显示动画\n        // input_panel.height(0);\n        // input_panel.stop().animate({height: min}, {duration: 50, easing: 'swing'});\n        input_panel.addClass('fixed');\n    }\n}\n\n\nfunction move_input_panel(step: number) {\n    let new_height = input_panel.height() + step;\n    if (new_height >= input_cards.height())\n        new_height = input_cards.height();\n    else if (new_height <= input_min_fixed_height() - 80)   //80 = #input-container.fixed padding-top + padding-bottom\n        new_height = input_min_fixed_height() - 80;\n\n    input_panel.height(new_height);\n    end_space.height(new_height - 40); // 40 =  #input-container.fixed padding-top\n}\n\n\n$(function () {\n    input_panel = $('#input-container');\n    input_cards = $('#input-cards');\n    end_space = $('#end-space');\n\n\n    let lastScrollTop = 0; // to Detecting scroll direction.  Credits: https://stackoverflow.com/questions/31223341/detecting-scroll-direction\n    $(window).on('scroll', function () {\n        let st = window.pageYOffset || document.documentElement.scrollTop; // Credits: \"https://github.com/qeremy/so/blob/master/so.dom.js#L426\"\n        let downmove = st < lastScrollTop;\n        let upmove = st > lastScrollTop;\n\n        if (!input_panel.hasClass('fixed')) {\n            // 40 =  #input-container.fixed padding-top\n            if (($(window).height() - input_panel[0].getBoundingClientRect().top < input_min_fixed_height() - 40) && downmove && has_input) {\n                toggle_input_panel_style(true);\n                st = window.pageYOffset || document.documentElement.scrollTop;\n            }\n        } else {\n            // 到达底部\n            // 50 = footer height\n            if ($(window).scrollTop() + window.innerHeight > $(document).height() - 50 && upmove) {  // issue $(window).height() < window.innerHeight in mobile phone\n                toggle_input_panel_style(false);\n                st = window.pageYOffset || document.documentElement.scrollTop;\n            }\n        }\n        lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling\n    });\n\n    input_panel[0].addEventListener(\"wheel\", function (e) {\n        // Credits: https://stackoverflow.com/questions/30892830/detect-scrolling-on-pages-without-a-scroll-bar\n\n        if (!input_panel.hasClass('fixed')) return;\n        e.preventDefault();\n\n        // to make it work on IE or Chrome\n        // @ts-ignore\n        let variation = parseInt(e.deltaY);\n        move_input_panel(variation);\n    });\n\n    let last_y = -1;\n    input_panel[0].addEventListener(\"touchstart\", function (evt) {\n        if (evt.changedTouches.length > 1)\n            return;\n        last_y = evt.changedTouches[0].screenY;\n    });\n\n\n    input_panel[0].addEventListener(\"touchmove\", function (evt) {\n        if (!input_panel.hasClass('fixed')) return;\n        if (evt.changedTouches.length > 1)\n            return;\n        evt.preventDefault();\n        let variation = last_y - evt.changedTouches[0].screenY;\n        last_y = evt.changedTouches[0].screenY;\n        move_input_panel(variation);\n    });\n});\n","// Indexable Types\n\ninterface Dict {\n    [index: string]: any;\n}\n\nexport class LRUMap {\n    keys: string[] = [];\n    map: Dict = {};\n\n    push(key: string, value: any) {\n        if (key in this.map)\n            return console.error(\"LRUMap: key:%s already in map\", key);\n        this.keys.push(key);\n        this.map[key] = value;\n    };\n\n    get_value(key: string) {\n        return this.map[key];\n    };\n\n    get_top() {\n        let top_key = this.keys[this.keys.length - 1];\n        return this.map[top_key];\n    };\n\n    set_value(key: string, value: any) {\n        if (!(key in this.map))\n            return console.error(\"LRUMap: key:%s not in map when call `set_value`\", key);\n        this.map[key] = value;\n    };\n\n    move_to_top(key: string) {\n        const index = this.keys.indexOf(key);\n        if (index > -1) {\n            this.keys.splice(index, 1);\n            this.keys.push(key);\n        } else {\n            return console.error(\"LRUMap: key:%s not in map when call `move_to_top`\", key);\n        }\n    };\n\n    remove(key: string) {\n        if (key in this.map) {\n            delete this.map[key];\n            this.keys.splice(this.keys.indexOf(key), 1);\n        } else {\n            return console.error(\"LRUMap: key:%s not in map when call `remove`\", key);\n        }\n    };\n\n}\n\n\nexport function b64toBlob(b64Data: string, contentType = 'application/octet-stream', sliceSize = 512) {\n    const byteCharacters = atob(b64Data);\n    const byteArrays = [];\n\n    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n        const slice = byteCharacters.slice(offset, offset + sliceSize);\n\n        const byteNumbers = new Array(slice.length);\n        for (let i = 0; i < slice.length; i++) {\n            byteNumbers[i] = slice.charCodeAt(i);\n        }\n\n        const byteArray = new Uint8Array(byteNumbers);\n        byteArrays.push(byteArray);\n    }\n\n    const blob = new Blob(byteArrays, {type: contentType});\n    return blob;\n}\n\nexport function make_set(arr: string[]) {\n    let set: { [i: string]: string } = {};\n    for (let val of arr)\n        set[val] = '';\n    return set;\n}\n\nexport function deep_copy(obj: any): any {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n\n// container 为带有滚动条的元素\nexport function body_scroll_to(target: JQuery, position = 'top', complete?: (this: HTMLElement) => void, offset = 0) {\n    let scrollTop = null;\n    if (position === 'top')\n        scrollTop = target.offset().top;\n    else if (position === 'middle')\n        scrollTop = target.offset().top + 0.5 * target[0].clientHeight - 0.5 * $(window).height();\n    else if (position === 'bottom')\n        scrollTop = target[0].clientHeight + target.offset().top - $(window).height();\n\n    let container = $('body,html');\n    let speed = Math.abs(container.scrollTop() - scrollTop - offset);\n    if (scrollTop !== null)\n        container.stop().animate({scrollTop: scrollTop + offset}, Math.min(speed, 500) + 100, complete);\n}\n\n// container 为带有滚动条的元素\nexport function box_scroll_to(target: JQuery, container: JQuery, position = 'top', complete?: (this: HTMLElement) => void, offset = 0) {\n    let scrollTopOffset = null;\n    if (position === 'top')\n        scrollTopOffset = target[0].getBoundingClientRect().top - container[0].getBoundingClientRect().top;\n    else if (position === 'middle')\n        scrollTopOffset = target[0].getBoundingClientRect().top - container[0].getBoundingClientRect().top - container.height() * 0.5 + target.height() * 0.5;\n    else if (position === 'bottom')\n        scrollTopOffset = target[0].getBoundingClientRect().bottom - container[0].getBoundingClientRect().bottom;\n\n    let speed = Math.min(Math.abs(scrollTopOffset + offset), 500) + 100;\n    if (scrollTopOffset !== null)\n        container.stop().animate({scrollTop: container.scrollTop() + scrollTopOffset + offset}, speed, complete);\n}\n\n\nexport function randomid(length: number) {\n    let result = '';\n    let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let charactersLength = characters.length;\n    for (let i = 0; i < length; i++) {\n        result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n    return result;\n}\n\n// 跳转PyWebIO Application\n// name: app名称\n// new_window: 是否在新窗口打开\nexport function openApp(name: string, new_window: boolean) {\n    let url = new URL(window.location.href);\n    url.searchParams.set(\"app\", name);\n    if (new_window)\n        window.open(url.href);\n    else\n        window.location.href = url.href;\n}\n\n\nexport function error_alert(text: string, duration: number = 1.5) {\n    Toastify({\n        text: Mustache.escape(text),\n        duration: duration * 1000,\n        gravity: \"top\",\n        position: 'center',\n        backgroundColor: '#e53935',\n    }).showToast();\n}"]}